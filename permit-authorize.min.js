!function t(e,r,n){function i(u,c){if(!r[u]){if(!e[u]){var o="function"==typeof require&&require;if(!c&&o)return o(u,!0);if(s)return s(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var l=r[u]={exports:{}};e[u][0].call(l.exports,function(t){var r=e[u][1][t];return i(r?r:t)},l,l.exports,t,e,r,n)}return r[u].exports}for(var s="function"==typeof require&&require,u=0;u<n.length;u++)i(n[u]);return i}({1:[function(){},{}],2:[function(t,e){(function(){e.exports={Authorizer:t("./lib/authorizer"),Ability:t("./lib/ability"),Allower:t("./lib/allower"),CachedAbility:t("./lib/ability/cached_ability"),Permit:t("./lib/permit"),RulesLoader:t("./lib/permit/permit_rules_loader"),DbRulesLoader:t("./lib/permit/permit_rules_db_loader"),permitFor:t("./lib/permit/permit_for")}}).call(this)},{"./lib/ability":3,"./lib/ability/cached_ability":5,"./lib/allower":8,"./lib/authorizer":9,"./lib/permit":18,"./lib/permit/permit_for":21,"./lib/permit/permit_rules_db_loader":24,"./lib/permit/permit_rules_loader":25}],3:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c,o,a,l={}.toString,h=[].slice;n=t("./util/lodash_lite"),i=t("./permit/permit_filter"),s=t("./allower"),u=t("./access_request"),c=t("./debugger"),o=t("./ability/arg_normalizer"),e.exports=a=function(){function t(t){this.user=t,this.validateUser()}t.displayName="Ability";var e=t.prototype;return r(e,arguments[0]),e.validateUser=function(){if(void 0===this.user)throw new Error("Ability must be for a User, was void");if("Object"!==l.call(this.user).slice(8,-1))throw new Error("User must be an Object, was "+this.user)},e.permits=function(){return i.filter(this.accessRequest())},e.allower=function(){return new s(this.accessRequest())},e.allowed=function(){return this.allower().allows()},e.notAllowed=function(){return this.allower().disallows()},e.can=function(){return this.args=h.call(arguments),this.authorize("can")},e.cannot=function(){return this.args=h.call(arguments),this.authorize("cannot")},e.authResult=function(){return this._result||(this._result="can"===this.act?this.allowed():this.notAllowed())},e.authorize=function(t){return this.act=t,this.clear(),this.debug("can result:",this.authResult()),this.authResult()},e.clear=function(){return this._result=void 0,this._accessRequest=void 0},e.accessRequest=function(){return this._accessRequest||(this._accessRequest=u.from(this.normalizedArgs(),this.debugging))},e.normalizedArgs=function(){return this.args=n.flatten(this.args),this.debug("normalize args",this.args),new o(this.args).setUser(this.user).normalized()},t}(c)}).call(this)},{"./ability/arg_normalizer":4,"./access_request":6,"./allower":8,"./debugger":10,"./permit/permit_filter":20,"./util/lodash_lite":29}],4:[function(t,e){(function(){var r,n,i={}.toString;r=t("../util/lodash_lite"),e.exports=n=function(){function t(t){this.args=t,"Object"===i.call(this.args).slice(8,-1)&&(this.args=[this.args])}t.displayName="ArgNormalizer";var e=t.prototype;return e.setUser=function(t){return this.user=t,this},e.userObj=function(){return null!=this.user?{user:this.user}:{}},e.normalized=function(){return r.extend(this.userObj(),this.normalizedObj())},e.normalizedObj=function(){return this.object()||this.createObject()},e.createObject=function(){return this.ctxObj()||this.baseObj()},e.ctxObj=function(){return this.args[2]?r.extend(this.baseObj(),{ctx:this.args[2]}):void 0},e.baseObj=function(){return{action:this.args[0],subject:this.args[1]}},e.object=function(){return"Object"===i.call(this.args[0]).slice(8,-1)?this.args[0]:void 0},t}()}).call(this)},{"../util/lodash_lite":29}],5:[function(t,e){(function(){function r(t,e){function r(){}return r.prototype=(t.superclass=e).prototype,(t.prototype=new r).constructor=t,"function"==typeof e.extended&&e.extended(t),t}function n(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}var i,s,u,c=[].slice;i=t("../ability"),s=t("../access_request/fingerprints"),e.exports=u=function(t){function e(t){this.user=t,e.superclass.apply(this,arguments),this.userKey()}var i=r((n(e,t).displayName="CachedAbility",e),t).prototype,u=e;return e.clearCache=function(){return u.canCache={},u.cannotCache={}},e.canCache=function(){return this._canCache||(this._canCache={})},e.cannotCache=function(){return this._cannotCache||(this._cannotCache={})},i.userHash=s.userHash,i.userKey=function(){return this.userKey=this.userHash()},i.authorize=function(t){var e;return this.act=t,e=c.call(arguments,1),this.clear(),this.hasCachedResult()?this.cachedResult():(this.cacheResult(),this.debug("cannot-res",this.authResult()),this.authResult())},i.accReqKey=function(){return this.accessRequest().accessHash()},i.hasCachedResult=function(){return void 0!==this.cachedResult()},i.clear=function(){return t.prototype.clear.call(this),this._lastResult=void 0},i.cachedResult=function(){return this._lastResult||(this._lastResult=this.cache()[this.accReqKey()])},i.cacheResult=function(){return this.cache()[this.accReqKey()]=this.authResult()},i.cache=function(){return this[this.act+"Cache"]()},i.canCache=function(){return u.canCache()[this.userKey]||{}},i.cannotCache=function(){return u.cannotCache()[this.userKey]||{}},e}(i)}).call(this)},{"../ability":3,"../access_request/fingerprints":7}],6:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c={}.toString;n=t("./util/normalize"),i=t("./debugger"),s=t("./access_request/fingerprints"),e.exports=u=function(){function t(t,e,r,n,i){this.user=t,this.action=e,this.subject=r,this.ctx=n,this.debugging=i,this.debug("create AccessRequest user:",this.user,"action:",this.action,"subject:",this.subject,"ctx:",this.ctx),this.validate(),this.normalize()}t.displayName="AccessRequest";var e=t.prototype;return r(e,arguments[0]),r(e,arguments[1]),t.from=function(e,r){if("Object"!==c.call(e).slice(8,-1))throw new Error("Must be an Object, was: "+e);return new t(e.user,e.action,e.subject,e.ctx,r)},e.normalize=function(){return this.debug("normalize action",this.action),this.action=n(this.action),"Object"!==c.call(this.subject).slice(8,-1)&&(this.debug("normalize subject",this.subject),this.subject=n(this.subject)),this},e.validate=function(){if(!this.validAction())throw new Error("Missing action name. Must authorize an action to be performed on a subject, was: "+this.action+", "+c.call(this.action).slice(8,-1));if(!this.validSubject())throw new Error("Missing subject. Must authorize a subject to perform an action: "+this.action);if(!this.validUser())throw new Error("Missing or invalid user. Must authorize a user to perform an action: "+this.action+" on the subject, was: "+this.user+" of type: "+c.call(this.user).slice(8,-1))},e.validSubject=function(){return null!=this.subject},e.validUser=function(){return"Object"===c.call(this.user).slice(8,-1)},e.validAction=function(){return"String"===c.call(this.action).slice(8,-1)||"Array"===c.call(this.action).slice(8,-1)},t}(i,s)}).call(this)},{"./access_request/fingerprints":7,"./debugger":10,"./util/normalize":30}],7:[function(t,e){(function(){function t(t,e){function r(){}return r.prototype=(t.superclass=e).prototype,(t.prototype=new r).constructor=t,"function"==typeof e.extended&&e.extended(t),t}function r(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}var n,i,s,u={}.toString;n=function(){function t(t){this.value=t}t.displayName="Fingerprint";var e=t.prototype;return e.fingerprint=function(){return this.none()||this.string()},e.string=function(){return"String"===u.call(this.value).slice(8,-1)?this.value:void 0},e.none=function(){return void 0===this.value?"x":void 0},t}(),i=function(e){function n(){n.superclass.apply(this,arguments)}var i=t((r(n,e).displayName="ObjectFingerprint",n),e).prototype;return i.fingerprint=function(){return e.prototype.fingerprint.call(this)||this.hash()||this.json()},i.hash=function(){return"Function"===u.call(this.value.hash).slice(8,-1)?this.value.hash():void 0},i.json=function(){return JSON.stringify(this.value)},n}(n),s=function(e){function n(){n.superclass.apply(this,arguments)}var i=t((r(n,e).displayName="ArrayFingerprint",n),e).prototype;return i.fingerprint=function(){return this.none()||this.string()||this.joined()},i.joined=function(){return"Array"===u.call(this.value).slice(8,-1)?this.value.join("."):void 0},n}(n),e.exports={accessHash:function(){return this._accessHash||(this._accessHash=[this.actionHash(),this.subjectHash(),this.ctxHash()].join(":"))},subjectHash:function(){return this.subjectFingerprint||(this.subjectFingerprint=new i(this.subject).fingerprint())},actionHash:function(){return this.actionFingerprint||(this.actionFingerprint=new s(this.action).fingerprint())},userHash:function(){return this.userFingerprint||(this.userFingerprint=new i(this.user).fingerprint())},ctxHash:function(){return this.ctxFingerprint||(this.ctxFingerprint=new i(this.ctx).fingerprint())}}}).call(this)},{}],8:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c;n=t("./util/lodash_lite"),i=t("./debugger"),s=t("./permit"),u=t("./permit/permit_filter"),e.exports=c=function(){function t(t,e){this.accessRequest=t,this.debugging=e,this.permits=u.filter(this.accessRequest)}t.displayName="Allower";var e=t.prototype;return r(e,arguments[0]),e.allows=function(){return this.debug("allows",this.accessRequest),this.test("allows")},e.disallows=function(){return this.debug("disallows",this.accessRequest),this.test("disallows")},e.test=function(t){var e,r,n,i;for(e=0,n=(r=this.permits).length;n>e;++e)if(i=r[e],this.debug("test permit",t,i),this.debug("with rules",i.rules),this.debugging&&i.debugOn(),i.applyRules(this.accessRequest),this.debug("permit rules"),i[t](this.accessRequest))return!0;return!1},t}(i),n.extend(c,i)}).call(this)},{"./debugger":10,"./permit":18,"./permit/permit_filter":20,"./util/lodash_lite":29}],9:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c={}.toString;n=t("./debugger"),i=t("./access_request"),s=t("./ability"),e.exports=u=function(){function t(t){this.user=t}t.displayName="Authorizer";var e=t.prototype;return r(e,arguments[0]),e.run=function(t,e,r){return"Object"===c.call(t).slice(8,-1)?this.run(t.action,t.subject,t.context):(this.debug("run",t,e,r),this.can(t,e,r))},e.createAbility=function(){var t;return t=new s(this.user),this.debugging&&t.debugOn(),t},e.ability=function(){return this.currentAbility||(this.currentAbility=this.createAbility())},e.access=function(t,e,r){var n;return n=new i(this.user,t,e,r,this.debugging),this.debugging&&n.debugOn(),n},e.authorize=function(t,e,r){return this.debug("authorize",t,e,r),this.ability().authorize(this.access(t,e,r))},e.can=function(t,e,r){return this.debug("can",t,e,r),this.ability().can(this.access(t,e,r))},e.cannot=function(t,e,r){return this.debug("cannot",t,e,r),this.ability().cannot(this.access(t,e,r))},t}(n)}).call(this)},{"./ability":3,"./access_request":6,"./debugger":10}],10:[function(t,e){(function(){e.exports={debugging:!1,debug:function(){return this.debugging?(console.log(this.constructor.displayName+":"),console.log.apply(this,arguments)):void 0},debugOn:function(){return this.debugging=!0},debugOff:function(){return this.debugging=!1}}}).call(this)},{}],11:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c,o,a,l={}.toString;n=t("../util/lodash_lite"),i=t("../debugger"),s=t("./user_matcher"),u=t("./action_matcher"),c=t("./subject_matcher"),o=t("./context_matcher"),a=function(){function t(t){this.accessRequest=t,this.matchResult=!0}t.displayName="AccessMatcher";var e=t.prototype;return r(e,arguments[0]),e.userMatcher=function(){return this.um||(this.um=new s(this.accessRequest))},e.subjectMatcher=function(){return this.sm||(this.sm=new c(this.accessRequest))},e.actionMatcher=function(){return this.am||(this.am=new u(this.accessRequest))},e.contextMatcher=function(){return this.cm||(this.cm=new o(this.accessRequest))},e.matchOn=function(t){var e,r,n,i;e=t;for(r in t)n=this[r],i=t[r],"Function"===l.call(n).slice(8,-1)&&(delete e[r],n.call(this,i).matchOn(e));return this.result()},e.result=function(){return this.matchResult},e.update=function(t){return this.matchResult=this.matchResult&&t},e.user=function(t){return this.update(this.userMatcher().match(t)),this},e.role=function(t){return this.user({role:t}),this},e.roles=function(t){var e,r,n;for(e=0,r=t.length;r>e;++e)n=t[e],this.matchResult||this.role(n);return this},e.subject=function(t){return this.update(this.subjectMatcher().match(t)),this},e.subjectClazz=function(t){return this.update(this.subjectMatcher().matchClazz(t)),this},e.action=function(t){return this.update(this.actionMatcher().match(t)),this},e.actions=function(t){var e,r,n;for(e=0,r=t.length;r>e;++e)n=t[e],this.matchResult||this.action(n);return this},e.context=function(t){return this.update(this.contextMatcher().match(t)),this},e.ctx=function(t){return this.context(t)},t}(i),n.extend(a,i),e.exports=a}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./action_matcher":12,"./context_matcher":14,"./subject_matcher":15,"./user_matcher":16}],12:[function(t,e){(function(){function r(t,e){function r(){}return r.prototype=(t.superclass=e).prototype,(t.prototype=new r).constructor=t,"function"==typeof e.extended&&e.extended(t),t}function n(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}var i,s,u,c,o={}.toString;i=t("../util/lodash_lite"),s=t("../debugger"),u=t("./base_matcher"),c=function(t){function e(t){this.accessRequest=t,e.superclass.apply(this,arguments),this.setAction()}var i=r((n(e,t).displayName="ActionMatcher",e),t).prototype;return i.setAction=function(){return this.action||(this.action=null!=this.accessRequest?this.accessRequest.action:"")},i.match=function(t){return"Function"===o.call(t).slice(8,-1)?t.call(this.action):this.deathMatch("action",t)?!0:this.action===t},e}(u),i.extend(c,s),e.exports=c}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./base_matcher":13}],13:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u;n=t("../util/lodash_lite"),i=t("../debugger"),s=requires.util("intersect"),u=function(){function t(t){this.setAccessRequest(t),this.setIntersect()}t.displayName="BaseMatcher";var e=t.prototype;return r(e,arguments[0]),e.match=function(){return!1},e.deathMatch=function(t,e){return this[t]&&void 0===e?!0:!1},e.setAccessRequest=function(t){return this.accessRequest=t?t:{}},e.setIntersect=function(){return this.intersect||(this.intersect=s())},t}(i),n.extend(u,i),e.exports=u}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],14:[function(t,e){(function(){function r(t,e){function r(){}return r.prototype=(t.superclass=e).prototype,(t.prototype=new r).constructor=t,"function"==typeof e.extended&&e.extended(t),t}function n(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}var i,s,u,c,o={}.toString;i=t("../util/lodash_lite"),s=t("../debugger"),u=t("./base_matcher"),c=function(t){function e(t){this.accessRequest=t,e.superclass.apply(this,arguments),this.setCtx()}var i=r((n(e,t).displayName="ContextMatcher",e),t).prototype;return i.setCtx=function(){return this.ctx||(this.ctx=null!=this.accessRequest?this.accessRequest.ctx:{})},i.match=function(t){return"Function"===o.call(t).slice(8,-1)?t.call(this.ctx):this.deathMatch("ctx",t)?!0:this.intersect.on(t,this.ctx)},e}(u),i.extend(c,s),e.exports=c}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./base_matcher":13}],15:[function(t,e){(function(){function r(t,e){function r(){}return r.prototype=(t.superclass=e).prototype,(t.prototype=new r).constructor=t,"function"==typeof e.extended&&e.extended(t),t}function n(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}var i,s,u,c,o={}.toString;i=t("../util/lodash_lite"),s=t("../debugger"),u=t("./base_matcher"),c=function(t){function e(t){this.accessRequest=t,e.superclass.apply(this,arguments),this.setSubject()}var i=r((n(e,t).displayName="SubjectMatcher",e),t).prototype;return i.setSubject=function(){return this.subject||(this.subject=null!=this.accessRequest?this.accessRequest.subject:{})},i.match=function(t){return"Function"===o.call(t).slice(8,-1)?t.call(this.subject):this.deathMatch("subject",t)?!0:this.intersect.on(t,this.subject)},i.matchClazz=function(t){var e;return e=t.camelize(),this.subject&&this.subject.constructor?this.subject.constructor.displayName===e:!1},e}(u),i.extend(c,s),e.exports=c}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./base_matcher":13}],16:[function(t,e){(function(){function r(t,e){function r(){}return r.prototype=(t.superclass=e).prototype,(t.prototype=new r).constructor=t,"function"==typeof e.extended&&e.extended(t),t}function n(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}var i,s,u,c,o={}.toString;i=t("../util/lodash_lite"),s=t("../debugger"),u=t("./base_matcher"),c=function(t){function e(t){this.accessRequest=t,e.superclass.apply(this,arguments),this.setUser()}var i=r((n(e,t).displayName="UserMatcher",e),t).prototype;return i.setUser=function(){return this.user||(this.user=null!=this.accessRequest?this.accessRequest.user:{})},i.match=function(t){return"Function"===o.call(t).slice(8,-1)?t.call(this.user):this.deathMatch("user",t)?!0:this.intersect.on(t,this.user)},e}(u),i.extend(c,s),e.exports=c}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./base_matcher":13}],17:[function(t,e){(function(){var r,n,i,s,u,c;r=t("./matcher/base_matcher"),n=t("./matcher/user_matcher"),i=t("./matcher/action_matcher"),s=t("./matcher/subject_matcher"),u=t("./matcher/context_matcher"),c=t("./matcher/access_matcher"),e.exports={BaseMatcher:r,UserMatcher:n,ActionMatcher:i,SubjectMatcher:s,ContextMatcher:u,AccessMatcher:c}}).call(this)},{"./matcher/access_matcher":11,"./matcher/action_matcher":12,"./matcher/base_matcher":13,"./matcher/context_matcher":14,"./matcher/subject_matcher":15,"./matcher/user_matcher":16}],18:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c,o,a,l,h,f,p,d,m,g,b={}.toString;n=t("./util/lodash_lite"),i=t("./debugger"),s=t("./permit/permit_registry"),u=t("./permit/permit_matcher"),c=t("./permit/permit_allower"),o=t("./rule/rule_applier"),a=t("./rule/rule_repo"),l=t("./matchers"),h=l.UserMatcher,f=l.SubjectMatcher,p=l.ActionMatcher,d=l.ContextMatcher,m=l.AccessMatcher,e.exports=g=function(){function t(t,e){this.name=t,this.description=null!=e?e:"",s.registerPermit(this),this.ruleRepo=new a(this.name),this.appliedRules=!1}t.displayName="Permit";var e=t.prototype;return r(e,arguments[0]),e.permitMatcherClass=u,e.ruleApplierClass=o,t.get=function(t){return s.get(t)},e.init=function(){return this.debug("permit init"),this.applyRules(),this.configureMatchers(),this},e.configureMatchers=function(){var t;if(this.debug("configure-matchers",this.matchesOn),"Object"===b.call(this.matchesOn).slice(8,-1)){this.compiledList=[],this.debug("compile...");for(t in this.matchesOn)this.compileFor(t,this.matchesOn[t]);return this.debug("compiled matchers:",this.compiledList)}},e.compileFor=function(t,e){var r;return this.debug("compile for",t,e),r=this.compiledMatcher(t,e),this.debug("fun",r),this.compiledList.push(r)},e.compiledMatcher=function(t,e){var r;return r=this,function(n){var i,s;return s={},s[t]=e,i=s,r.debug("compiled fun: match-on",n),r.matchOn(n,i)}},e.clean=function(){return this.ruleRepo.clean(),this.appliedRules=!1},e.use=function(t){if("Function"===b.call(t).slice(8,-1)&&(t=t()),"Object"===b.call(t).slice(8,-1))return n.extend(this,t);throw Error("Can only extend permit with an Object, was: "+b.call(t).slice(8,-1))},e.rules=function(){},e.permitAllower=function(){return new c(this.ruleRepo,this.debugging)},e.allows=function(t){var e;return this.debug("permit allows?",this.name,this.description),e=this.permitAllower().allows(t),this.debug(this.name+" Permit allows:",this.rules,t,e),e},e.disallows=function(t){var e;return this.debug("permit disallows?",this.name,this.description),e=this.permitAllower().disallows(t),this.debug(this.name+" Permit disallows:",this.rules,t,e),e},e.matching=function(t){return new m(t)},e.matcher=function(t){return new this.permitMatcherClass(this,t,this.debugging)},e.matches=function(t){var e;return this.debug("matches",t),e=this.matcher(t),this.debug("permit matcher",e),e.match()},e.matchOn=function(t,e){return this.matching(t).matchOn(e)},e.matchUser=function(t,e){return this.matching(t).user(e)},e.matchRole=function(t,e){return this.matching(t).role(e)},e.matchSubject=function(t,e){return this.matching(t).subject(e)},e.matchSubjectClazz=function(){return{subjectClazz:this.matching(accessRequest).clazz}},e.matchAction=function(t){return this.matching(accessRequest).action(t)},e.matchContext=function(t){return this.matches(accessRequest).context(t)},e.matchCtx=function(t){return this.matching(accessRequest).ctx(t)},e.ruleApplier=function(t){return"Object"!==b.call(t).slice(8,-1)&&(t={}),new this.ruleApplierClass(this.ruleRepo,this.rules,t,this.debugging)},e.applyRules=function(t,e){return void 0!==t&&"Object"!==b.call(t).slice(8,-1)&&(e=Boolean(t)),!this.appliedRules||e?(this.debug("permit apply rules",t),this.ruleApplier(t).applyRules(),this.appliedRules=!0):this.debug("rules already applied before",this.appliedRules)},e.canRules=function(){return this.ruleRepo.canRules},e.cannotRules=function(){return this.ruleRepo.cannotRules},t}(i),n.extend(g,i)}).call(this)},{"./debugger":10,"./matchers":17,"./permit/permit_allower":19,"./permit/permit_matcher":22,"./permit/permit_registry":23,"./rule/rule_applier":26,"./rule/rule_repo":27,"./util/lodash_lite":29}],19:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u={}.toString;n=t("../util/lodash_lite"),i=t("../debugger"),e.exports=s=function(){function t(t,e){if(this.ruleRepo=t,this.debugging=e,"Object"!==u.call(this.ruleRepo).slice(8,-1))throw Error("PermitAllower must take a RuleRepo in constructor, was: "+this.ruleRepo)}t.displayName="PermitAllower";var e=t.prototype;return r(e,arguments[0]),e.testAccess=function(t,e){var r;return this.debug("test-access",t,e),this.debugging&&this.ruleRepo.debugOn(),r=this.ruleRepo.matchRule(t,e),this.debug("subj",r),r===!0},e.allows=function(t,e){return this.debug("allows",t,e),!e&&this.disallows(t,!0)?!1:this.testAccess("can",t)===!1?!1:!0},e.disallows=function(t,e){return this.debug("disallows",t,e),this.testAccess("cannot",t)===!0?!0:!1},t}(i),n.extend(s,i)}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],20:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c,o={}.toString;n=t("../util/lodash_lite"),i=t("../debugger"),s=t("../permit"),u=t("../permit/permit_registry"),e.exports=c=function(){function t(){}t.displayName="PermitFilter";var e=t.prototype;return r(e,arguments[0]),t.filter=function(t){var e,r,i,s;if(e=this,r=function(r){if(e.debug("matching",r,t),!r.matches)throw Error("Permit must have a .matches(access-request) method: "+r);return r.matches(t)},i=this.permits(),"Array"!==o.call(i).slice(8,-1))throw Error("permits which contain all registered permits, must be an Array, was: "+typeof i);return this.debug("filter permits",i,t),s=n.filter(i,r),this.debug("filtered",s),s},t.permits=function(){return n.values(u.permits)},t}(i),n.extend(c,i)}).call(this)},{"../debugger":10,"../permit":18,"../permit/permit_registry":23,"../util/lodash_lite":29}],21:[function(t,e){(function(){var r,n,i={}.toString;r=t("../util/lodash_lite"),n=t("../permit"),e.exports=function(t,e,r,s){var u;return"String"===i.call(t).slice(8,-1)&&(r=e,e=t,t=n),u=new t(e),s===!0&&u.debugOn(),null!=r&&"Function"===i.call(r).slice(8,-1)&&(r=r()),"Object"===i.call(r).slice(8,-1)&&(u=u.use(r)),u.init()}}).call(this)},{"../permit":18,"../util/lodash_lite":29}],22:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c,o={}.toString;n=t("../util/lodash_lite"),i=t("../util/intersect"),s=t("../matcher/access_matcher"),u=requires.lib("debugger"),e.exports=c=function(){function t(t,e,r){this.permit=t,this.accessRequest=e,this.debugging=r,this.intersect=i(),this.debugging&&this.debugOn(),this.validate()}t.displayName="PermitMatcher";var e=t.prototype;return r(e,arguments[0]),e.match=function(t){var e,r;return null==t&&(t={}),this.debug("permit-matcher match"),e=(this.include()||this.customMatch())&&!(this.exclude()||this.customExMatch()),t.compiled===!1?e:(this.debug("compiled result:",this.matchCompiled()),r=this.matchCompiled(),this.debug("mc res",r),e||r)},e.matchCompiled=function(){var t,e,r,n,i;if(this.debug("match-compiled",this.permit.compiledList),"Array"!==o.call(this.permit.compiledList).slice(8,-1))return!1;for(this.debug("compiled matchers: "+this.permit.compiledList.length),t=!1,e=0,n=(r=this.permit.compiledList).length;n>e&&(i=r[e],i(this.accessRequest)&&(t=!0),this.debug("compile fun res",t),!t);++e);return t},e.include=function(){return this.intersectOn(this.permit.includes)},e.exclude=function(){return this.intersectOn(this.permit.excludes)},e.customExMatch=function(){var t;if("Function"===o.call(this.permit.exMatch).slice(8,-1)){if(t=this.permit.exMatch(this.accessRequest),t.constructor===s)return t.result();if(void 0===t)return!0;if("Boolean"!==o.call(t).slice(8,-1))throw Error(".match method of permit "+this.permit.name+" must return a Boolean value, was: "+o.call(t).slice(8,-1));return t}return this.debug("permit.ex-match function not found for permit: "+this.permit),!1},e.customMatch=function(){var t;if("Function"===o.call(this.permit.match).slice(8,-1)){if(t=this.permit.match(this.accessRequest),this.debug("custom-match",this.permit.match,t),t.constructor===s)return t.result();if(void 0===t)return!0;if("Boolean"!==o.call(t).slice(8,-1))throw Error(".match method of permit "+this.permit.name+" must return a Boolean value, was: "+o.call(t).slice(8,-1));return t}return this.debug("permit.match function not found for permit: "+this.permit),!1},e.intersectOn=function(t){var e;return null==t?!1:("Function"===o.call(t).slice(8,-1)&&(t=t()),e=this.intersect.on(t,this.accessRequest))},e.validate=function(){if(!this.permit)throw Error("PermitMatcher missing permit");if(null!=this.accessRequest&&void 0===this.accessRequest)throw Error("access-request is undefined")},t}(u),n.extend(c,u)}).call(this)},{"../matcher/access_matcher":11,"../util/intersect":28,"../util/lodash_lite":29}],23:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c={}.toString;n=t("../util/lodash_lite"),i=t("../debugger"),s="allow creation of multiple registries and select one to use per environment",e.exports=u=function(){function t(){throw Error("PermitRegistry is currently a singleton (TODO: "+s+")")}t.displayName="PermitRegistry";var e=t.prototype,i=t;return r(e,arguments[0]),t.permits={},t.permitCounter=0,t.calcName=function(t){if(void 0===t&&(t="Permit-"+i.permitCounter),"String"!==c.call(t).slice(8,-1))throw Error("Name of permit must be a String, was: "+t);return t},t.get=function(t){return i.permits[t]||function(){throw Error("No permit '"+t+"' is registered")}()},t.registerPermit=function(t){var e;if(t.name=this.calcName(t.name),e=t.name,"Object"!==c.call(i.permits).slice(8,-1))throw Error("permits registry container must be an Object in order to store permits by name, was: "+i.permits);if(i.permits[e])throw Error("A Permit named: "+e+" is already registered, please use a different name!");return i.permits[e]=t,i.permitCounter=i.permitCounter+1},t.clearPermits=function(){return i.permits={},i.permitCounter=0},t.clearAll=function(){return i.clearPermits()},t.permitList=function(){return n.values(i.permits)},t.cleanPermits=function(){var t,e,r,n,s=[];for(t=0,r=(e=i.permitList()).length;r>t;++t)n=e[t],s.push(n.clean());return s},t.cleanAll=function(){return i.cleanPermits()},t}(i),n.extend(u,i)}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],24:[function(t,e){(function(){function r(t,e){function r(){}return r.prototype=(t.superclass=e).prototype,(t.prototype=new r).constructor=t,"function"==typeof e.extended&&e.extended(t),t}function n(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}function i(t,e){for(var r in e)t[r]=e[r];return t}var s,u,c;s=t("../util/lodash_lite"),u=t("../debugger"),c=function(t){function e(t){this.filePath=t,e.superclass}var s=r((n(e,t).displayName="PermitRulesDbLoader",e),t).prototype;return i(s,arguments[1]),s.loadDb=function(t){return this.options=null!=t?t:{},this.connectDb(),this.loadData(),this.loadedRules=JSON.parse(data),this.processRules()},s.connectDb=function(){},s.loadData=function(){},e}(PermitRulesLoader,u),e.exports=c}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],25:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c,o={}.toString;n=t("../util/lodash_lite"),i=t("../debugger"),s=t("fs"),u=t("../permit/permit_for"),Array.prototype.contains=function(t){return this.indexOf(t)>-1},c=function(){function t(t,e){this.filePath=t,this.options=null!=e?e:{},this.loadedRules={},this.async=this.options.async}t.displayName="PermitRulesLoader";var e=t.prototype;return r(e,arguments[0]),e.createPermit=function(t,e){var r,n,i;return null==e&&(e={}),r||(r=e.clazz||requires.lib("permit")),n=this.loadRules().rules(),console.log("loaded-rules",n,this.filePath),i=u(r,t,function(){return{rules:{}}}),e.key?i.rules[key]=n:i.rules=n},e.loadRules=function(t,e){if(this.filePath||(this.filePath=t),void 0!==e?this.async=e:this.async||(this.async=!0),this.debug("loadRules",this.filePath),!this.filePath)throw Error("Error: Missing filepath");return this.async?this.loadRulesAsync(t):this.loadRulesSync(t)},e.loadRulesAsync=function(){var t;return this.debug("loadRulesAsync"),t=this,s.readFile(this.filePath,"utf8",function(e,r){var n;if(t.debug(e,r),e)throw this.debug(e),Error("Error loading file: "+this.filePath+" - "+e);return t.debug("data",r),n=JSON.parse(r),t.debug("loaded-rules",n),t.loadedRules=n,t.processRules()}),this},e.loadRulesSync=function(){var t,e,r;try{if(t=s.readFileSync(this.filePath,"utf8",function(){}),this.debug("data",t),"String"!==o.call(t).slice(8,-1))throw Error;return e=JSON.parse(t),this.debug("loaded-rules",e),this.loadedRules=e,this.processRules(),this}catch(n){throw r=n,Error("Error loading file: "+this.filePath+" - "+r)}},e.loadRulesFrom=function(t){return this.loadRules(t)},e.load=function(t){return this.loadRules(t)},e.processRules=function(){var t,e,r;if(this.debug("processRules",this.loadedRules),"Object"!==o.call(this.loadedRules).slice(8,-1))throw Error("Rules not loaded or invalid: "+this.loadedRules);this.processedRules={};for(t in e=this.loadedRules)r=e[t],this.processRule(t,r);return this.processedRules},e.processRule=function(t,e){return this.debug("processRule",t,e),this.processedRules[t]=this.ruleFor(e)},e.createRulesAt=function(t,e){if("Function"!==o.call(t).slice(8,-1))throw Error("Not a permit, was: "+t);if(null!=e){if(null==t.rules||"Object"!==o.call(t.rules).slice(8,-1))throw Error("Permit has no rules object to place loaded rules at "+e);return t.rules[e]=this.processedRules}return t.rules=this.processedRules},e.rules=function(){return this.processedRules},e.ruleFor=function(t){var e;if(this.debug("ruleFor",t),e=Object.keys(t)[0],!["can","cannot"].contains(e))throw Error("Not a valid rule key, must be 'can' or 'cannot', was: "+e);return this.factory(e,t[e])},e.factory=function(t,e){var r,n,i,s;r=[];for(n in e)i=e[n],s=this.resolve(t,n,i),r.push(s);return function(){var t,e,n,i,s=[];for(t=0,n=(e=r).length;n>t;++t)i=e[t],s.push(this.rule());return s}},e.resolve=function(t,e,r){return function(){return this["u"+t](e,r)}},t}(i),e.exports=c}).call(this)},{"../debugger":10,"../permit/permit_for":21,"../util/lodash_lite":29,fs:1}],26:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];
return t}var n,i,s,u,c,o={}.toString;n=t("../util/lodash_lite"),i=t("../debugger"),s=function(t,e){var r,n=[];switch(o.call(t).slice(8,-1)){case"Function":return t.call(e);case"Object":for(r in t)n.push(s(r,e));return n}},u=function(t){return"Object"===o.call(t).slice(8,-1)||"Function"===o.call(t).slice(8,-1)},e.exports=c=function(){function t(t,e,r,n){if(this.repo=t,this.rules=e,this.accessRequest=r,this.debugging=n,"Object"!==o.call(this.repo).slice(8,-1))throw Error("RuleApplier must be passed a RuleRepo, was: "+this.repo);if(!u(this.rules))throw Error("RuleApplier must be passed the rules to be applied, was: "+this.rules);if(void 0!==this.accessRequest&&"Object"!==o.call(this.accessRequest).slice(8,-1))throw Error("AccessRequest must be an Object, was: "+this.accessRequest);this.debugging=this.debugging}t.displayName="RuleApplier";var e=t.prototype;return r(e,arguments[0]),e.action=function(){var t;return null!=(t=this.accessRequest)?t.action:void 0},e.user=function(){var t;return null!=(t=this.accessRequest)?t.user:void 0},e.subject=function(){var t;return null!=(t=this.accessRequest)?t.subject:void 0},e.ctx=function(){var t;return null!=(t=this.accessRequest)?t.ctx:void 0},e.canRules=function(){return this.repo.canRules},e.cannotRules=function(){return this.repo.cannotRules},e.applyRulesFor=function(t,e){var r,n;return this.debug("apply rules for "+t+" in context: "+e),"Object"===o.call(t).slice(8,-1)&&this.applyObjRulesFor(t,e),"String"!==o.call(t).slice(8,-1)?(this.debug("Name to apply rules for must be a String, was: "+typeof t+" : "+t),this):(r=this.contextRules(e),n=r[t],"Function"===o.call(n).slice(8,-1)?n.call(this,this.accessRequest):this.debug("rules key for "+t+" should be a function that resolves one or more rules"),this)},e.applyObjRulesFor=function(t,e){var r,n,i,s,u,c=[];r=this.contextRules(e),this.debug("apply-obj-rules-for",t,e,r),n=Object.keys(t),"User"===t.clazz&&(n=["name","role"]);for(i in n)s=t[i],"User"===t.clazz&&this.applyRulesFor(s,e),u=r[i],c.push(this.applyRulesFor(s,u));return c},e.contextRules=function(t){return"Object"===o.call(t).slice(8,-1)?t:"String"!==o.call(t).slice(8,-1)?this.rules:"Object"===o.call(this.rules[t]).slice(8,-1)?this.rules[t]:(this.debug("no such rules context: "+t,this.rules),this.rules)},e.applyActionRules=function(){return this.applyRulesFor(this.action()),this.applyRulesFor(this.action(),"action"),this},e.applyUserRules=function(){return this.applyRulesFor(this.user()),this.applyRulesFor(this.user(),"user"),this},e.applySubjectRules=function(){return this.applyRulesFor(this.subject()),this.applyRulesFor(this.subject(),"subject"),this},e.applyCtxRules=function(){return this.applyRulesFor(this.ctx()),this.applyRulesFor(this.ctx(),"ctx"),this.applyRulesFor(this.ctx(),"context"),this},e.applyContextRules=function(){return this.applyCtxRules()},e.validRequest=function(){return!n.isEmpty(this.accessRequest)},e.applyDefaultRules=function(){return this.debug("apply-default-rules",this.accessRequest,this.validRequest()),"Object"===o.call(this.accessRequest).slice(8,-1)&&this.validRequest()?this.applyAccessRules():this.applyRulesFor("default"),this},e.applyRules=function(){if(!u(this.rules))return void this.debug("invalid permit rules could not be applied");switch(this.debug("applying rules",this.rules,"for",this.accessRequest),typeof this.rules){case"function":this.rules();break;case"object":this.applyDefaultRules();break;default:throw Error("rules must be a Function or an Object, was: "+this.rules)}return this},e.applyAccessRules=function(){return this.debug("apply access rules on",this.accessRequest),this.applyActionRules(),this.applyUserRules(),this.applyCtxRules(),this},e.applyAllRules=function(){var t,e,r,n;switch(typeof this.rules){case"object":t=this.rules,e=this,r=this;for(n in t)r.recurse(t[n],e);break;default:throw Error("rules must be an Object was: "+typeof this.rules)}return this},e.ucan=function(t,e,r){return this.repo.registerRule("can",t,e,r)},e.ucannot=function(t,e,r){return this.repo.registerRule("cannot",t,e,r)},t}(i),n.extend(c,i)}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],27:[function(t,e){(function(){function r(t,e){for(var r in e)t[r]=e[r];return t}var n,i,s,u,c,o={}.toString;n=t("../util/lodash_lite"),i=t("../debugger"),s=t("../util/string_util").camelCase,u=t("../util/normalize"),e.exports=c=function(){function t(t){this.name=t}t.displayName="RuleRepo";var e=t.prototype;return r(e,arguments[0]),e.canRules={},e.cannotRules={},e.display=function(){return console.log("name:",this.name),console.log("can-rules:",this.canRules),console.log("cannot-rules:",this.cannotRules)},e.cleanAll=function(){return this.clean("can"),this.clean("cannot"),this},e.clean=function(t){if(void 0===t)return this.cleanAll();if("can"!==t&&"cannot"!==t)throw Error("Repo can only clear 'can' or 'cannot' rules, was: "+t);return this.debug("clean",t),this[t+"Rules"]={},this},e.clearAll=function(){return this.cleanAll()},e.clear=function(t){return this.clean(t)},e.subjectClazz=function(t){var e;return e="Object"===o.call(t).slice(8,-1)?t.constructor.displayName:t},e.wildcards=["*","any"],e.findMatchingSubject=function(t,e){var r,i;if(n.find(this.wildcards,function(e){return-1!==t.indexOf(e)}))return!0;if("Array"===o.call(e).slice(8,-1))return r=this,n.find(e,function(e){return r.findMatchingSubject(t,e)});if("String"!==o.call(e).slice(8,-1))throw Error("find-matching-subject: Subject must be a String to be matched, was "+e);return i=s(e),-1!==t.indexOf(i)},e.matchRule=function(t,e){var r,n,i,u,c;return this.debug("match-rule",t,e),t=s(t),r=e.action,n=e.subject,i=this.subjectClazz(n),u=this.containerFor(t),"manage"===r&&this.matchManageRule(u,i),this.debug("subj-clazz",i),i&&(c=u[r])?this.matchSubjectClazz(c,i):void 0},e.matchSubjectClazz=function(t,e){return this.debug("match-subject-clazz",t,e),"Array"!==o.call(t).slice(8,-1)?!1:this.findMatchingSubject(t,e)},e.matchManageRule=function(t,e){var r,n;return r=t.manage,n=matchSubjectClazz(r,e),n?n:manageActionSubjects(t).all(function(t){return matchSubjectClazz(t,e)})},e.manageActionSubjects=function(t){return n.map(this.manageActions(),function(e){return t[e]})},e.manageActions=function(){return["create","edit","delete"]},e.addRule=function(t,e,r){var i,c,a,l;if("Object"!==o.call(t).slice(8,-1))throw Error("Container must be an object");return i=t[e]||[],r=u(r),i=i.concat(r),i=n.map(i,function(t){var e;return e=s(t),"Any"===e?"*":e}),c=n.unique(i),a=t[e],"Array"!==o.call(a).slice(8,-1)&&(a=[]),t[e]=this.registerActionSubjects(a,c),"manage"===e?(l=this,n.each(this.manageActions(),function(e){return t[e]=l.registerActionSubjects(a,c)})):void 0},e.registerActionSubjects=function(t,e){return n.unique(t.concat(e))},e.containerFor=function(t){var e;if(t=t.toLowerCase(),e=this[t+"Rules"],"Object"!==o.call(e).slice(8,-1))throw Error("No valid rule container for: "+t);return e},e.registerRule=function(t,e,r){var n,i,s,c,o=[];for(e=u(e),n=this.containerFor(t),i=0,s=e.length;s>i;++i)c=e[i],o.push(this.addRule(n,c,r));return o},t}(i),n.extend(c,i)}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"../util/normalize":30,"../util/string_util":31}],28:[function(t,e){(function(){var r,n={}.toString;r=t("./lodash_lite"),e.exports=function(){var t,e,r;return t=function(t){var e,r,n,i;for(e=0,r=0,n=t.length;n>r;++r)i=t[r],t.hasOwnProperty(i)&&e++;return e},e=function(r,i){var s,u,c,o;if(typeof r!=typeof i)return!1;if("Object"===n.call(r).slice(8,-1)&&"Object"===n.call(i).slice(8,-1)){if(t(r)!==t(i))return!1;for(s=!0,u=0,c=r.length;c>u;++u)if(o=r[u],s=e(r[o],i[o]),!s)return!1;return!0}return r===i},r=function(t,i){var s,u,c,o,a;if(s={},void 0===t||void 0===i)return!1;for(u in t)s[u]=!1,c=t[u],o=i[u],void 0!==c&&("Object"===n.call(c).slice(8,-1)&&"Object"===n.call(o).slice(8,-1)?null!=o&&(a=r(c,o)):a=e(c,o),a&&(s[u]=!0));for(u in t)if(!s[u])return!1;return!0},{on:function(t,e){return r(t,e)}}}}).call(this)},{"./lodash_lite":29}],29:[function(t,e,r){(function(t){(function(){function n(t,e,r){r=(r||0)-1;for(var n=t?t.length:0;++r<n;)if(t[r]===e)return r;return-1}function i(t,e){var r=typeof e;if(t=t.l,"boolean"==r||null==e)return t[e]?0:-1;"number"!=r&&"string"!=r&&(r="object");var i="number"==r?e:U+e;return t=(t=t[r])&&t[i],"object"==r?t&&-1<n(t,e)?0:-1:t?0:-1}function s(t){var e=this.l,r=typeof t;if("boolean"==r||null==t)e[t]=!0;else{"number"!=r&&"string"!=r&&(r="object");var n="number"==r?t:U+t,e=e[r]||(e[r]={});"object"==r?(e[n]||(e[n]=[])).push(t):e[n]=!0}}function u(){return D.pop()||{k:null,l:null,"false":!1,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1}}function c(t){t.length=0,N.length<B&&N.push(t)}function o(t){var e=t.l;e&&o(e),t.k=t.l=t.object=t.number=t.string=null,D.length<B&&D.push(t)}function a(t,e){var r;e||(e=0),"undefined"==typeof r&&(r=t?t.length:0);var n=-1;r=r-e||0;for(var i=Array(0>r?0:r);++n<r;)i[n]=t[e+n];return i}function l(){}function h(t){function e(){if(n){var t=a(n);ge.apply(t,arguments)}if(this instanceof e){var s=f(r.prototype),t=r.apply(s,t||arguments);return w(t)?t:s}return r.apply(i,t||arguments)}var r=t[0],n=t[2],i=t[4];return Ae(e,t),e}function f(t){return w(t)?Re(t):{}}function p(t,e,r){if("function"!=typeof t)return F;if("undefined"==typeof e||!("prototype"in t))return t;var n=t.__bindData__;if("undefined"==typeof n&&(Oe.funcNames&&(n=!t.name),n=n||!Oe.funcDecomp,!n)){var i=de.call(t);Oe.funcNames||(n=!K.test(i)),n||(n=I.test(i),Ae(t,n))}if(!1===n||!0!==n&&1&n[1])return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,i){return t.call(e,r,n,i)};case 4:return function(r,n,i,s){return t.call(e,r,n,i,s)}}return z(t,e)}function d(t){function e(){var t=o?u:this;if(i){var g=a(i);ge.apply(g,arguments)}return(s||h)&&(g||(g=a(arguments)),s&&ge.apply(g,s),h&&g.length<c)?(n|=16,d([r,p?n:-4&n,g,null,u,c])):(g||(g=arguments),l&&(r=t[m]),this instanceof e?(t=f(r.prototype),g=r.apply(t,g),w(g)?g:t):r.apply(t,g))}var r=t[0],n=t[1],i=t[2],s=t[3],u=t[4],c=t[5],o=1&n,l=2&n,h=4&n,p=8&n,m=r;return Ae(e,t),e}function m(t,e,r){for(var n=-1,i=t?t.length:0,s=[];++n<i;){var u=t[n];if(u&&"object"==typeof u&&"number"==typeof u.length&&(qe(u)||R(u))){e||(u=m(u,e,r));var c=-1,o=u.length,a=s.length;for(s.length+=o;++c<o;)s[a++]=u[c]}else r||s.push(u)}return s}function g(t,e,r,n,i,s){if(r){var u=r(t,e);if("undefined"!=typeof u)return!!u}if(t===e)return 0!==t||1/t==1/e;if(t===t&&!(t&&re[typeof t]||e&&re[typeof e]))return!1;if(null==t||null==e)return t===e;var o=fe.call(t),a=fe.call(e);if(o==T&&(o=X),a==T&&(a=X),o!=a)return!1;switch(o){case G:case V:return+t==+e;case Q:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case Y:case Z:return t==String(e)}if(a=o==$,!a){var l=me.call(t,"__wrapped__"),h=me.call(e,"__wrapped__");if(l||h)return g(l?t.__wrapped__:t,h?e.__wrapped__:e,r,n,i,s);if(o!=X)return!1;if(o=!Oe.argsObject&&R(t)?Object:t.constructor,l=!Oe.argsObject&&R(e)?Object:e.constructor,o!=l&&!(j(o)&&o instanceof o&&j(l)&&l instanceof l)&&"constructor"in t&&"constructor"in e)return!1}for(o=!i,i||(i=N.pop()||[]),s||(s=N.pop()||[]),l=i.length;l--;)if(i[l]==t)return s[l]==e;var f=0,u=!0;if(i.push(t),s.push(e),a){if(l=t.length,f=e.length,(u=f==l)||n)for(;f--;)if(a=l,h=e[f],n)for(;a--&&!(u=g(t[a],h,r,n,i,s)););else if(!(u=g(t[f],h,r,n,i,s)))break}else Fe(e,function(e,c,o){return me.call(o,c)?(f++,u=me.call(t,c)&&g(t[c],e,r,n,i,s)):void 0}),u&&!n&&Fe(t,function(t,e,r){return me.call(r,e)?u=-1<--f:void 0});return i.pop(),s.pop(),o&&(c(i),c(s)),u}function b(t,e,r,n,i,s){var u=1&e,c=4&e,o=16&e,l=32&e;if(!(2&e||j(t)))throw new TypeError;o&&!r.length&&(e&=-17,o=r=!1),l&&!n.length&&(e&=-33,l=n=!1);var f=t&&t.__bindData__;return f&&!0!==f?(f=a(f),f[2]&&(f[2]=a(f[2])),f[3]&&(f[3]=a(f[3])),!u||1&f[1]||(f[4]=i),!u&&1&f[1]&&(e|=8),!c||4&f[1]||(f[5]=s),o&&ge.apply(f[2]||(f[2]=[]),r),l&&ye.apply(f[3]||(f[3]=[]),n),f[1]|=e,b.apply(null,f)):(1==e||17===e?h:d)([t,e,r,n,i,s])}function y(){ee.h=J,ee.b=ee.c=ee.g=ee.i="",ee.e="t",ee.j=!0;for(var t,e=0;t=arguments[e];e++)for(var r in t)ee[r]=t[r];e=ee.a,ee.d=/^[^,]+/.exec(e)[0],t=Function,e="return function("+e+"){",r=ee;var n="var n,t="+r.d+",E="+r.e+";if(!t)return E;"+r.i+";";r.b?(n+="var u=t.length;n=-1;if("+r.b+"){",Oe.unindexedChars&&(n+="if(s(t)){t=t.split('')}"),n+="while(++n<u){"+r.g+";}}else{"):Oe.nonEnumArgs&&(n+="var u=t.length;n=-1;if(u&&p(t)){while(++n<u){n+='';"+r.g+";}}else{"),Oe.enumPrototypes&&(n+="var G=typeof t=='function';"),Oe.enumErrorProps&&(n+="var F=t===k||t instanceof Error;");var i=[];if(Oe.enumPrototypes&&i.push('!(G&&n=="prototype")'),Oe.enumErrorProps&&i.push('!(F&&(n=="message"||n=="name"))'),r.j&&r.f)n+="var C=-1,D=B[typeof t]&&v(t),u=D?D.length:0;while(++C<u){n=D[C];",i.length&&(n+="if("+i.join("&&")+"){"),n+=r.g+";",i.length&&(n+="}"),n+="}";else if(n+="for(n in t){",r.j&&i.push("m.call(t, n)"),i.length&&(n+="if("+i.join("&&")+"){"),n+=r.g+";",i.length&&(n+="}"),n+="}",Oe.nonEnumShadows){for(n+="if(t!==A){var i=t.constructor,r=t===(i&&i.prototype),f=t===J?I:t===k?j:L.call(t),x=y[f];",k=0;7>k;k++)n+="n='"+r.h[k]+"';if((!(r&&x[n])&&m.call(t,n))",r.j||(n+="||(!x[n]&&t[n]!==A[n])"),n+="){"+r.g+"}";n+="}"}return(r.b||Oe.nonEnumArgs)&&(n+="}"),n+=r.c+";return E",t("d,j,k,m,o,p,q,s,v,A,B,y,I,J,L",e+n+"}")(p,W,ae,me,L,R,qe,_,ee.f,le,re,xe,Z,he,fe)}function v(t){return"function"==typeof t&&pe.test(t)}function R(t){return t&&"object"==typeof t&&"number"==typeof t.length&&fe.call(t)==T||!1}function j(t){return"function"==typeof t}function w(t){return!(!t||!re[typeof t])}function _(t){return"string"==typeof t||t&&"object"==typeof t&&fe.call(t)==Z||!1}function x(t,e,r){var n=[];if(e=l.createCallback(e,r,3),qe(t)){r=-1;for(var i=t.length;++r<i;){var s=t[r];e(s,r,t)&&n.push(s)}}else ze(t,function(t,r,i){e(t,r,i)&&n.push(t)});return n}function O(t,e,r){if(e=l.createCallback(e,r,3),!qe(t)){var n;return ze(t,function(t,r,i){return e(t,r,i)?(n=t,!1):void 0}),n}r=-1;for(var i=t.length;++r<i;){var s=t[r];if(e(s,r,t))return s}}function A(t,e,r){if(e&&"undefined"==typeof r&&qe(t)){r=-1;for(var n=t.length;++r<n&&!1!==e(t[r],r,t););}else ze(t,e,r);return t}function q(t,e,r){var n=-1,i=t?t.length:0,s=Array("number"==typeof i?i:0);if(e=l.createCallback(e,r,3),qe(t))for(;++n<i;)s[n]=e(t[n],n,t);else ze(t,function(t,r,i){s[++n]=e(t,r,i)});return s}function S(t,e,r){if("number"==typeof r){var i=t?t.length:0;r=0>r?_e(0,i+r):r||0}else if(r)return r=E(t,e),t[r]===e?r:-1;return n(t,e,r)}function E(t,e,r,n){var i=0,s=t?t.length:i;for(r=r?l.createCallback(r,n,1):F,e=r(e);s>i;)n=i+s>>>1,r(t[n])<e?i=n+1:s=n;return i}function C(t,e,r,a){"boolean"!=typeof e&&null!=e&&(a=r,r="function"!=typeof e&&a&&a[e]===t?null:e,e=!1),null!=r&&(r=l.createCallback(r,a,3)),a=-1;var h,f=(f=l.indexOf)===S?n:f;h=f;var f=t?t.length:0,p=[],d=!e&&f>=H&&h===n,m=r||d?N.pop()||[]:p;if(d){h=m;var m=-1,g=h.length,b=h[0],y=h[g/2|0],v=h[g-1];if(b&&"object"==typeof b&&y&&"object"==typeof y&&v&&"object"==typeof v)m=!1;else{for(b=u(),b["false"]=b["null"]=b["true"]=b.undefined=!1,y=u(),y.k=h,y.l=b,y.push=s;++m<g;)y.push(h[m]);m=y}h=i}for(;++a<f;)g=t[a],b=r?r(g,a,t):g,(e?!a||m[m.length-1]!==b:0>h(m,b))&&((r||d)&&m.push(b),p.push(g));return d?(c(m.k),o(m)):r&&c(m),p}function z(t,e){return 2<arguments.length?b(t,17,a(arguments,2),null,e):b(t,1,null,null,e)}function F(t){return t}function M(){}function P(t){return function(e){return e[t]}}var N=[],D=[],L={},U=+new Date+"",H=75,B=40,K=/^\s*function[ \n\r\t]+\w/,I=/\bthis\b/,J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),T="[object Arguments]",$="[object Array]",G="[object Boolean]",V="[object Date]",W="[object Error]",Q="[object Number]",X="[object Object]",Y="[object RegExp]",Z="[object String]",te={configurable:!1,enumerable:!1,value:null,writable:!1},ee={a:"",b:null,c:"",d:"",e:"",v:null,g:"",h:null,support:null,i:"",j:!1},re={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},ne=re[typeof window]&&window||this,ie=re[typeof r]&&r&&!r.nodeType&&r,se=re[typeof e]&&e&&!e.nodeType&&e,ue=se&&se.exports===ie&&ie,ce=re[typeof t]&&t;!ce||ce.global!==ce&&ce.window!==ce||(ne=ce);var oe=[],ae=Error.prototype,le=Object.prototype,he=String.prototype,fe=le.toString,pe=RegExp("^"+String(fe).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),de=Function.prototype.toString,me=le.hasOwnProperty,ge=oe.push,be=le.propertyIsEnumerable,ye=oe.unshift,ve=function(){try{var t={},e=v(e=Object.defineProperty)&&e,r=e(t,t,t)&&e}catch(n){}return r}(),Re=v(Re=Object.create)&&Re,je=v(je=Array.isArray)&&je,we=v(we=Object.keys)&&we,_e=Math.max,xe={};xe[$]=xe[V]=xe[Q]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},xe[G]=xe[Z]={constructor:!0,toString:!0,valueOf:!0},xe[W]=xe["[object Function]"]=xe[Y]={constructor:!0,toString:!0},xe[X]={constructor:!0},function(){for(var t=J.length;t--;){var e,r=J[t];for(e in xe)me.call(xe,e)&&!me.call(xe[e],r)&&(xe[e][r]=!1)}}();var Oe=l.support={};!function(){function t(){this.x=1}var e={0:1,length:1},r=[];t.prototype={valueOf:1,y:1};for(var n in new t)r.push(n);for(n in arguments);Oe.argsClass=fe.call(arguments)==T,Oe.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),Oe.enumErrorProps=be.call(ae,"message")||be.call(ae,"name"),Oe.enumPrototypes=be.call(t,"prototype"),Oe.funcDecomp=!v(ne.m)&&I.test(function(){return this}),Oe.funcNames="string"==typeof Function.name,Oe.nonEnumArgs=0!=n,Oe.nonEnumShadows=!/valueOf/.test(r),Oe.spliceObjects=(oe.splice.call(e,0,1),!e[0]),Oe.unindexedChars="xx"!="x"[0]+Object("x")[0]}(1),Re||(f=function(){function t(){}return function(e){if(w(e)){t.prototype=e;var r=new t;t.prototype=null}return r||ne.Object()}}());var Ae=ve?function(t,e){te.value=e,ve(t,"__bindData__",te)}:M;Oe.argsClass||(R=function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&me.call(t,"callee")&&!be.call(t,"callee")||!1});var qe=je||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&fe.call(t)==$||!1},Se=y({a:"z",e:"[]",i:"if(!(B[typeof z]))return E",g:"E.push(n)"}),Ee=we?function(t){return w(t)?Oe.enumPrototypes&&"function"==typeof t||Oe.nonEnumArgs&&t.length&&R(t)?Se(t):we(t):[]}:Se,ce={a:"g,e,K",i:"e=e&&typeof K=='undefined'?e:d(e,K,3)",b:"typeof u=='number'",v:Ee,g:"if(e(t[n],n,g)===false)return E"},Ce={a:"z,H,l",i:"var a=arguments,b=0,c=typeof l=='number'?2:a.length;while(++b<c){t=a[b];if(t&&B[typeof t]){",v:Ee,g:"if(typeof E[n]=='undefined')E[n]=t[n]",c:"}}"},je={i:"if(!B[typeof t])return E;"+ce.i,b:!1},ze=y(ce),Ce=y(Ce,{i:Ce.i.replace(";",";if(c>3&&typeof a[c-2]=='function'){var e=d(a[--c-1],a[c--],2)}else if(c>2&&typeof a[c-1]=='function'){e=a[--c]}"),g:"E[n]=e?e(E[n],t[n]):t[n]"}),Fe=y(ce,je,{j:!1}),Me=y(ce,je);j(/x/)&&(j=function(t){return"function"==typeof t&&"[object Function]"==fe.call(t)}),l.assign=Ce,l.bind=z,l.createCallback=function(t,e,r){var n=typeof t;if(null==t||"function"==n)return p(t,e,r);if("object"!=n)return P(t);var i=Ee(t),s=i[0],u=t[s];return 1!=i.length||u!==u||w(u)?function(e){for(var r=i.length,n=!1;r--&&(n=g(e[i[r]],t[i[r]],null,!0)););return n}:function(t){return t=t[s],u===t&&(0!==u||1/u==1/t)}},l.filter=x,l.flatten=function(t,e,r,n){return"boolean"!=typeof e&&null!=e&&(n=r,r="function"!=typeof e&&n&&n[e]===t?null:e,e=!1),null!=r&&(t=q(t,r,n)),m(t,e)},l.forEach=A,l.forIn=Fe,l.forOwn=Me,l.keys=Ee,l.map=q,l.property=P,l.uniq=C,l.values=function(t){for(var e=-1,r=Ee(t),n=r.length,i=Array(n);++e<n;)i[e]=t[r[e]];return i},l.collect=q,l.each=A,l.extend=Ce,l.select=x,l.unique=C,l.find=O,l.identity=F,l.indexOf=S,l.isArguments=R,l.isArray=qe,l.isEmpty=function(t){var e=!0;if(!t)return e;var r=fe.call(t),n=t.length;return r==$||r==Z||(Oe.argsClass?r==T:R(t))||r==X&&"number"==typeof n&&j(t.splice)?!n:(Me(t,function(){return e=!1}),e)},l.isFunction=j,l.isObject=w,l.isString=_,l.noop=M,l.sortedIndex=E,l.detect=O,l.findWhere=O,l.VERSION="2.4.1","function"==typeof define&&"object"==typeof define.amd&&define.amd?(ne._=l,define(function(){return l})):ie&&se?ue?(se.exports=l)._=l:ie._=l:ne._=l}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],30:[function(t,e){(function(){var r,n,i,s={}.toString;r=t("./lodash_lite"),n=function(t,e){var r,i,u;if(e||(e=[]),"String"===s.call(t).slice(8,-1))return t;for(r=0,i=t.length;i>r;++r)u=t[r],"Array"===s.call(u).slice(8,-1)?n(u,e):e.push(u);return e},i=function(t,e){var u;return u=function(){switch(s.call(t).slice(8,-1)){case"Function":return i(t(),!0);case"String":return e?t:[t];case"Array":return r.map(t,function(t){return i(t,!0)});default:throw Error(t+" "+s.call(t).slice(8,-1)+" can't be normalized, must be a Function, String or Array")}}(),n(u)},e.exports=i}).call(this)},{"./lodash_lite":29}],31:[function(t,e){(function(){e.exports={camelCase:function(t){return(t||"").toLowerCase().replace(/(\b|-)\w/g,function(t){return t.toUpperCase().replace(/-/,"")})}}}).call(this)},{}]},{},[2]);