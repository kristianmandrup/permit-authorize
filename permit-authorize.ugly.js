!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(){},{}],2:[function(require,module){(function(){module.exports={Authorizer:require("./lib/authorizer"),Ability:require("./lib/ability"),Allower:require("./lib/allower"),CachedAbility:require("./lib/ability/cached_ability"),Permit:require("./lib/permit"),RulesLoader:require("./lib/permit/permit_rules_loader"),DbRulesLoader:require("./lib/permit/permit_rules_db_loader"),permitFor:require("./lib/permit/permit_for")}}).call(this)},{"./lib/ability":3,"./lib/ability/cached_ability":5,"./lib/allower":8,"./lib/authorizer":9,"./lib/permit":18,"./lib/permit/permit_for":21,"./lib/permit/permit_rules_db_loader":24,"./lib/permit/permit_rules_loader":25}],3:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,permitFilter,Allower,AccessRequest,Debugger,ArgNormalizer,Ability,toString$={}.toString,slice$=[].slice;lo=require("./util/lodash_lite"),permitFilter=require("./permit/permit_filter"),Allower=require("./allower"),AccessRequest=require("./access_request"),Debugger=require("./debugger"),ArgNormalizer=require("./ability/arg_normalizer"),module.exports=Ability=function(){function Ability(user){this.user=user,this.validateUser()}Ability.displayName="Ability";var prototype=Ability.prototype;return importAll$(prototype,arguments[0]),prototype.validateUser=function(){if(void 0===this.user)throw new Error("Ability must be for a User, was void");if("Object"!==toString$.call(this.user).slice(8,-1))throw new Error("User must be an Object, was "+this.user)},prototype.permits=function(){return permitFilter.filter(this.accessRequest())},prototype.allower=function(){return new Allower(this.accessRequest())},prototype.allowed=function(){return this.allower().allows()},prototype.notAllowed=function(){return this.allower().disallows()},prototype.can=function(){return this.args=slice$.call(arguments),this.authorize("can")},prototype.cannot=function(){return this.args=slice$.call(arguments),this.authorize("cannot")},prototype.authResult=function(){return this._result||(this._result="can"===this.act?this.allowed():this.notAllowed())},prototype.authorize=function(act){return this.act=act,this.clear(),this.debug("can result:",this.authResult()),this.authResult()},prototype.clear=function(){return this._result=void 0,this._accessRequest=void 0},prototype.accessRequest=function(){return this._accessRequest||(this._accessRequest=AccessRequest.from(this.normalizedArgs(),this.debugging))},prototype.normalizedArgs=function(){return this.args=lo.flatten(this.args),this.debug("normalize args",this.args),new ArgNormalizer(this.args).setUser(this.user).normalized()},Ability}(Debugger)}).call(this)},{"./ability/arg_normalizer":4,"./access_request":6,"./allower":8,"./debugger":10,"./permit/permit_filter":20,"./util/lodash_lite":29}],4:[function(require,module){(function(){var lo,ArgNormalizer,toString$={}.toString;lo=require("../util/lodash_lite"),module.exports=ArgNormalizer=function(){function ArgNormalizer(args){this.args=args,"Object"===toString$.call(this.args).slice(8,-1)&&(this.args=[this.args])}ArgNormalizer.displayName="ArgNormalizer";var prototype=ArgNormalizer.prototype;return prototype.setUser=function(user){return this.user=user,this},prototype.userObj=function(){return null!=this.user?{user:this.user}:{}},prototype.normalized=function(){return lo.extend(this.userObj(),this.normalizedObj())},prototype.normalizedObj=function(){return this.object()||this.createObject()},prototype.createObject=function(){return this.ctxObj()||this.baseObj()},prototype.ctxObj=function(){return this.args[2]?lo.extend(this.baseObj(),{ctx:this.args[2]}):void 0},prototype.baseObj=function(){return{action:this.args[0],subject:this.args[1]}},prototype.object=function(){return"Object"===toString$.call(this.args[0]).slice(8,-1)?this.args[0]:void 0},ArgNormalizer}()}).call(this)},{"../util/lodash_lite":29}],5:[function(require,module){(function(){function extend$(sub,sup){function fun(){}return fun.prototype=(sub.superclass=sup).prototype,(sub.prototype=new fun).constructor=sub,"function"==typeof sup.extended&&sup.extended(sub),sub}function import$(obj,src){var own={}.hasOwnProperty;for(var key in src)own.call(src,key)&&(obj[key]=src[key]);return obj}var Ability,fingerprints,CachedAbility,slice$=[].slice;Ability=require("../ability"),fingerprints=require("../access_request/fingerprints"),module.exports=CachedAbility=function(superclass){function CachedAbility(user){this.user=user,CachedAbility.superclass.apply(this,arguments),this.userKey()}var prototype=extend$((import$(CachedAbility,superclass).displayName="CachedAbility",CachedAbility),superclass).prototype,constructor=CachedAbility;return CachedAbility.clearCache=function(){return constructor.canCache={},constructor.cannotCache={}},CachedAbility.canCache=function(){return this._canCache||(this._canCache={})},CachedAbility.cannotCache=function(){return this._cannotCache||(this._cannotCache={})},prototype.userHash=fingerprints.userHash,prototype.userKey=function(){return this.userKey=this.userHash()},prototype.authorize=function(act){var args;return this.act=act,args=slice$.call(arguments,1),this.clear(),this.hasCachedResult()?this.cachedResult():(this.cacheResult(),this.debug("cannot-res",this.authResult()),this.authResult())},prototype.accReqKey=function(){return this.accessRequest().accessHash()},prototype.hasCachedResult=function(){return void 0!==this.cachedResult()},prototype.clear=function(){return superclass.prototype.clear.call(this),this._lastResult=void 0},prototype.cachedResult=function(){return this._lastResult||(this._lastResult=this.cache()[this.accReqKey()])},prototype.cacheResult=function(){return this.cache()[this.accReqKey()]=this.authResult()},prototype.cache=function(){return this[this.act+"Cache"]()},prototype.canCache=function(){return constructor.canCache()[this.userKey]||{}},prototype.cannotCache=function(){return constructor.cannotCache()[this.userKey]||{}},CachedAbility}(Ability)}).call(this)},{"../ability":3,"../access_request/fingerprints":7}],6:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var normalize,Debugger,Fingerprints,AccessRequest,toString$={}.toString;normalize=require("./util/normalize"),Debugger=require("./debugger"),Fingerprints=require("./access_request/fingerprints"),module.exports=AccessRequest=function(){function AccessRequest(user,action,subject,ctx,debugging){this.user=user,this.action=action,this.subject=subject,this.ctx=ctx,this.debugging=debugging,this.debug("create AccessRequest user:",this.user,"action:",this.action,"subject:",this.subject,"ctx:",this.ctx),this.validate(),this.normalize()}AccessRequest.displayName="AccessRequest";var prototype=AccessRequest.prototype;return importAll$(prototype,arguments[0]),importAll$(prototype,arguments[1]),AccessRequest.from=function(obj,debugging){if("Object"!==toString$.call(obj).slice(8,-1))throw new Error("Must be an Object, was: "+obj);return new AccessRequest(obj.user,obj.action,obj.subject,obj.ctx,debugging)},prototype.normalize=function(){return this.debug("normalize action",this.action),this.action=normalize(this.action),"Object"!==toString$.call(this.subject).slice(8,-1)&&(this.debug("normalize subject",this.subject),this.subject=normalize(this.subject)),this},prototype.validate=function(){if(!this.validAction())throw new Error("Missing action name. Must authorize an action to be performed on a subject, was: "+this.action+", "+toString$.call(this.action).slice(8,-1));if(!this.validSubject())throw new Error("Missing subject. Must authorize a subject to perform an action: "+this.action);if(!this.validUser())throw new Error("Missing or invalid user. Must authorize a user to perform an action: "+this.action+" on the subject, was: "+this.user+" of type: "+toString$.call(this.user).slice(8,-1))},prototype.validSubject=function(){return null!=this.subject},prototype.validUser=function(){return"Object"===toString$.call(this.user).slice(8,-1)},prototype.validAction=function(){return"String"===toString$.call(this.action).slice(8,-1)||"Array"===toString$.call(this.action).slice(8,-1)},AccessRequest}(Debugger,Fingerprints)}).call(this)},{"./access_request/fingerprints":7,"./debugger":10,"./util/normalize":30}],7:[function(require,module){(function(){function extend$(sub,sup){function fun(){}return fun.prototype=(sub.superclass=sup).prototype,(sub.prototype=new fun).constructor=sub,"function"==typeof sup.extended&&sup.extended(sub),sub}function import$(obj,src){var own={}.hasOwnProperty;for(var key in src)own.call(src,key)&&(obj[key]=src[key]);return obj}var Fingerprint,ObjectFingerprint,ArrayFingerprint,toString$={}.toString;Fingerprint=function(){function Fingerprint(value){this.value=value}Fingerprint.displayName="Fingerprint";var prototype=Fingerprint.prototype;return prototype.fingerprint=function(){return this.none()||this.string()},prototype.string=function(){return"String"===toString$.call(this.value).slice(8,-1)?this.value:void 0},prototype.none=function(){return void 0===this.value?"x":void 0},Fingerprint}(),ObjectFingerprint=function(superclass){function ObjectFingerprint(){ObjectFingerprint.superclass.apply(this,arguments)}var prototype=extend$((import$(ObjectFingerprint,superclass).displayName="ObjectFingerprint",ObjectFingerprint),superclass).prototype;return prototype.fingerprint=function(){return superclass.prototype.fingerprint.call(this)||this.hash()||this.json()},prototype.hash=function(){return"Function"===toString$.call(this.value.hash).slice(8,-1)?this.value.hash():void 0},prototype.json=function(){return JSON.stringify(this.value)},ObjectFingerprint}(Fingerprint),ArrayFingerprint=function(superclass){function ArrayFingerprint(){ArrayFingerprint.superclass.apply(this,arguments)}var prototype=extend$((import$(ArrayFingerprint,superclass).displayName="ArrayFingerprint",ArrayFingerprint),superclass).prototype;return prototype.fingerprint=function(){return this.none()||this.string()||this.joined()},prototype.joined=function(){return"Array"===toString$.call(this.value).slice(8,-1)?this.value.join("."):void 0},ArrayFingerprint}(Fingerprint),module.exports={accessHash:function(){return this._accessHash||(this._accessHash=[this.actionHash(),this.subjectHash(),this.ctxHash()].join(":"))},subjectHash:function(){return this.subjectFingerprint||(this.subjectFingerprint=new ObjectFingerprint(this.subject).fingerprint())},actionHash:function(){return this.actionFingerprint||(this.actionFingerprint=new ArrayFingerprint(this.action).fingerprint())},userHash:function(){return this.userFingerprint||(this.userFingerprint=new ObjectFingerprint(this.user).fingerprint())},ctxHash:function(){return this.ctxFingerprint||(this.ctxFingerprint=new ObjectFingerprint(this.ctx).fingerprint())}}}).call(this)},{}],8:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,Permit,PermitFilter,Allower;lo=require("./util/lodash_lite"),Debugger=require("./debugger"),Permit=require("./permit"),PermitFilter=require("./permit/permit_filter"),module.exports=Allower=function(){function Allower(accessRequest,debugging){this.accessRequest=accessRequest,this.debugging=debugging,this.permits=PermitFilter.filter(this.accessRequest)}Allower.displayName="Allower";var prototype=Allower.prototype;return importAll$(prototype,arguments[0]),prototype.allows=function(){return this.debug("allows",this.accessRequest),this.test("allows")},prototype.disallows=function(){return this.debug("disallows",this.accessRequest),this.test("disallows")},prototype.test=function(allowType){var i$,ref$,len$,permit;for(i$=0,len$=(ref$=this.permits).length;len$>i$;++i$)if(permit=ref$[i$],this.debug("test permit",allowType,permit),this.debug("with rules",permit.rules),this.debugging&&permit.debugOn(),permit.applyRules(this.accessRequest),this.debug("permit rules"),permit[allowType](this.accessRequest))return!0;return!1},Allower}(Debugger),lo.extend(Allower,Debugger)}).call(this)},{"./debugger":10,"./permit":18,"./permit/permit_filter":20,"./util/lodash_lite":29}],9:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var Debugger,AccessRequest,Ability,Authorizer,toString$={}.toString;Debugger=require("./debugger"),AccessRequest=require("./access_request"),Ability=require("./ability"),module.exports=Authorizer=function(){function Authorizer(user){this.user=user}Authorizer.displayName="Authorizer";var prototype=Authorizer.prototype;return importAll$(prototype,arguments[0]),prototype.run=function(action,subject,context){return"Object"===toString$.call(action).slice(8,-1)?this.run(action.action,action.subject,action.context):(this.debug("run",action,subject,context),this.can(action,subject,context))},prototype.createAbility=function(){var a;return a=new Ability(this.user),this.debugging&&a.debugOn(),a},prototype.ability=function(){return this.currentAbility||(this.currentAbility=this.createAbility())},prototype.access=function(action,subject,ctx){var ar;return ar=new AccessRequest(this.user,action,subject,ctx,this.debugging),this.debugging&&ar.debugOn(),ar},prototype.authorize=function(action,subject,context){return this.debug("authorize",action,subject,context),this.ability().authorize(this.access(action,subject,context))},prototype.can=function(action,subject,context){return this.debug("can",action,subject,context),this.ability().can(this.access(action,subject,context))},prototype.cannot=function(action,subject,context){return this.debug("cannot",action,subject,context),this.ability().cannot(this.access(action,subject,context))},Authorizer}(Debugger)}).call(this)},{"./ability":3,"./access_request":6,"./debugger":10}],10:[function(require,module){(function(){module.exports={debugging:!1,debug:function(){return this.debugging?(console.log(this.constructor.displayName+":"),console.log.apply(this,arguments)):void 0},debugOn:function(){return this.debugging=!0},debugOff:function(){return this.debugging=!1}}}).call(this)},{}],11:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,UserMatcher,ActionMatcher,SubjectMatcher,ContextMatcher,AccessMatcher,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),UserMatcher=require("./user_matcher"),ActionMatcher=require("./action_matcher"),SubjectMatcher=require("./subject_matcher"),ContextMatcher=require("./context_matcher"),AccessMatcher=function(){function AccessMatcher(accessRequest){this.accessRequest=accessRequest,this.matchResult=!0}AccessMatcher.displayName="AccessMatcher";var prototype=AccessMatcher.prototype;return importAll$(prototype,arguments[0]),prototype.userMatcher=function(){return this.um||(this.um=new UserMatcher(this.accessRequest))},prototype.subjectMatcher=function(){return this.sm||(this.sm=new SubjectMatcher(this.accessRequest))},prototype.actionMatcher=function(){return this.am||(this.am=new ActionMatcher(this.accessRequest))},prototype.contextMatcher=function(){return this.cm||(this.cm=new ContextMatcher(this.accessRequest))},prototype.matchOn=function(hash){var all,key,matchFun,matchValue;all=hash;for(key in hash)matchFun=this[key],matchValue=hash[key],"Function"===toString$.call(matchFun).slice(8,-1)&&(delete all[key],matchFun.call(this,matchValue).matchOn(all));return this.result()},prototype.result=function(){return this.matchResult},prototype.update=function(result){return this.matchResult=this.matchResult&&result},prototype.user=function(user){return this.update(this.userMatcher().match(user)),this},prototype.role=function(role){return this.user({role:role}),this},prototype.roles=function(roles){var i$,len$,role;for(i$=0,len$=roles.length;len$>i$;++i$)role=roles[i$],this.matchResult||this.role(role);return this},prototype.subject=function(subject){return this.update(this.subjectMatcher().match(subject)),this},prototype.subjectClazz=function(clazz){return this.update(this.subjectMatcher().matchClazz(clazz)),this},prototype.action=function(action){return this.update(this.actionMatcher().match(action)),this},prototype.actions=function(actions){var i$,len$,action;for(i$=0,len$=actions.length;len$>i$;++i$)action=actions[i$],this.matchResult||this.action(action);return this},prototype.context=function(ctx){return this.update(this.contextMatcher().match(ctx)),this},prototype.ctx=function(ctx){return this.context(ctx)},AccessMatcher}(Debugger),lo.extend(AccessMatcher,Debugger),module.exports=AccessMatcher}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./action_matcher":12,"./context_matcher":14,"./subject_matcher":15,"./user_matcher":16}],12:[function(require,module){(function(){function extend$(sub,sup){function fun(){}return fun.prototype=(sub.superclass=sup).prototype,(sub.prototype=new fun).constructor=sub,"function"==typeof sup.extended&&sup.extended(sub),sub}function import$(obj,src){var own={}.hasOwnProperty;for(var key in src)own.call(src,key)&&(obj[key]=src[key]);return obj}var lo,Debugger,BaseMatcher,ActionMatcher,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),BaseMatcher=require("./base_matcher"),ActionMatcher=function(superclass){function ActionMatcher(accessRequest){this.accessRequest=accessRequest,ActionMatcher.superclass.apply(this,arguments),this.setAction()}var prototype=extend$((import$(ActionMatcher,superclass).displayName="ActionMatcher",ActionMatcher),superclass).prototype;return prototype.setAction=function(){return this.action||(this.action=null!=this.accessRequest?this.accessRequest.action:"")},prototype.match=function(action){return"Function"===toString$.call(action).slice(8,-1)?action.call(this.action):this.deathMatch("action",action)?!0:this.action===action},ActionMatcher}(BaseMatcher),lo.extend(ActionMatcher,Debugger),module.exports=ActionMatcher}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./base_matcher":13}],13:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,Intersect,BaseMatcher;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),Intersect=requires.util("intersect"),BaseMatcher=function(){function BaseMatcher(accessRequest){this.setAccessRequest(accessRequest),this.setIntersect()}BaseMatcher.displayName="BaseMatcher";var prototype=BaseMatcher.prototype;return importAll$(prototype,arguments[0]),prototype.match=function(){return!1},prototype.deathMatch=function(name,value){return this[name]&&void 0===value?!0:!1},prototype.setAccessRequest=function(accessRequest){return this.accessRequest=accessRequest?accessRequest:{}},prototype.setIntersect=function(){return this.intersect||(this.intersect=Intersect())},BaseMatcher}(Debugger),lo.extend(BaseMatcher,Debugger),module.exports=BaseMatcher}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],14:[function(require,module){(function(){function extend$(sub,sup){function fun(){}return fun.prototype=(sub.superclass=sup).prototype,(sub.prototype=new fun).constructor=sub,"function"==typeof sup.extended&&sup.extended(sub),sub}function import$(obj,src){var own={}.hasOwnProperty;for(var key in src)own.call(src,key)&&(obj[key]=src[key]);return obj}var lo,Debugger,BaseMatcher,ContextMatcher,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),BaseMatcher=require("./base_matcher"),ContextMatcher=function(superclass){function ContextMatcher(accessRequest){this.accessRequest=accessRequest,ContextMatcher.superclass.apply(this,arguments),this.setCtx()}var prototype=extend$((import$(ContextMatcher,superclass).displayName="ContextMatcher",ContextMatcher),superclass).prototype;return prototype.setCtx=function(){return this.ctx||(this.ctx=null!=this.accessRequest?this.accessRequest.ctx:{})},prototype.match=function(ctx){return"Function"===toString$.call(ctx).slice(8,-1)?ctx.call(this.ctx):this.deathMatch("ctx",ctx)?!0:this.intersect.on(ctx,this.ctx)},ContextMatcher}(BaseMatcher),lo.extend(ContextMatcher,Debugger),module.exports=ContextMatcher}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./base_matcher":13}],15:[function(require,module){(function(){function extend$(sub,sup){function fun(){}return fun.prototype=(sub.superclass=sup).prototype,(sub.prototype=new fun).constructor=sub,"function"==typeof sup.extended&&sup.extended(sub),sub}function import$(obj,src){var own={}.hasOwnProperty;for(var key in src)own.call(src,key)&&(obj[key]=src[key]);return obj}var lo,Debugger,BaseMatcher,SubjectMatcher,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),BaseMatcher=require("./base_matcher"),SubjectMatcher=function(superclass){function SubjectMatcher(accessRequest){this.accessRequest=accessRequest,SubjectMatcher.superclass.apply(this,arguments),this.setSubject()}var prototype=extend$((import$(SubjectMatcher,superclass).displayName="SubjectMatcher",SubjectMatcher),superclass).prototype;return prototype.setSubject=function(){return this.subject||(this.subject=null!=this.accessRequest?this.accessRequest.subject:{})},prototype.match=function(subject){return"Function"===toString$.call(subject).slice(8,-1)?subject.call(this.subject):this.deathMatch("subject",subject)?!0:this.intersect.on(subject,this.subject)},prototype.matchClazz=function(subject){var clazz;return clazz=subject.camelize(),this.subject&&this.subject.constructor?this.subject.constructor.displayName===clazz:!1},SubjectMatcher}(BaseMatcher),lo.extend(SubjectMatcher,Debugger),module.exports=SubjectMatcher}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./base_matcher":13}],16:[function(require,module){(function(){function extend$(sub,sup){function fun(){}return fun.prototype=(sub.superclass=sup).prototype,(sub.prototype=new fun).constructor=sub,"function"==typeof sup.extended&&sup.extended(sub),sub}function import$(obj,src){var own={}.hasOwnProperty;for(var key in src)own.call(src,key)&&(obj[key]=src[key]);return obj}var lo,Debugger,BaseMatcher,UserMatcher,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),BaseMatcher=require("./base_matcher"),UserMatcher=function(superclass){function UserMatcher(accessRequest){this.accessRequest=accessRequest,UserMatcher.superclass.apply(this,arguments),this.setUser()}var prototype=extend$((import$(UserMatcher,superclass).displayName="UserMatcher",UserMatcher),superclass).prototype;return prototype.setUser=function(){return this.user||(this.user=null!=this.accessRequest?this.accessRequest.user:{})},prototype.match=function(user){return"Function"===toString$.call(user).slice(8,-1)?user.call(this.user):this.deathMatch("user",user)?!0:this.intersect.on(user,this.user)},UserMatcher}(BaseMatcher),lo.extend(UserMatcher,Debugger),module.exports=UserMatcher}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"./base_matcher":13}],17:[function(require,module){(function(){var BaseMatcher,UserMatcher,ActionMatcher,SubjectMatcher,ContextMatcher,AccessMatcher;BaseMatcher=require("./matcher/base_matcher"),UserMatcher=require("./matcher/user_matcher"),ActionMatcher=require("./matcher/action_matcher"),SubjectMatcher=require("./matcher/subject_matcher"),ContextMatcher=require("./matcher/context_matcher"),AccessMatcher=require("./matcher/access_matcher"),module.exports={BaseMatcher:BaseMatcher,UserMatcher:UserMatcher,ActionMatcher:ActionMatcher,SubjectMatcher:SubjectMatcher,ContextMatcher:ContextMatcher,AccessMatcher:AccessMatcher}}).call(this)},{"./matcher/access_matcher":11,"./matcher/action_matcher":12,"./matcher/base_matcher":13,"./matcher/context_matcher":14,"./matcher/subject_matcher":15,"./matcher/user_matcher":16}],18:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,PermitRegistry,PermitMatcher,PermitAllower,RuleApplier,RuleRepo,matchers,UserMatcher,SubjectMatcher,ActionMatcher,ContextMatcher,AccessMatcher,Permit,toString$={}.toString;lo=require("./util/lodash_lite"),Debugger=require("./debugger"),PermitRegistry=require("./permit/permit_registry"),PermitMatcher=require("./permit/permit_matcher"),PermitAllower=require("./permit/permit_allower"),RuleApplier=require("./rule/rule_applier"),RuleRepo=require("./rule/rule_repo"),matchers=require("./matchers"),UserMatcher=matchers.UserMatcher,SubjectMatcher=matchers.SubjectMatcher,ActionMatcher=matchers.ActionMatcher,ContextMatcher=matchers.ContextMatcher,AccessMatcher=matchers.AccessMatcher,module.exports=Permit=function(){function Permit(name,description){this.name=name,this.description=null!=description?description:"",PermitRegistry.registerPermit(this),this.ruleRepo=new RuleRepo(this.name),this.appliedRules=!1}Permit.displayName="Permit";var prototype=Permit.prototype;return importAll$(prototype,arguments[0]),prototype.permitMatcherClass=PermitMatcher,prototype.ruleApplierClass=RuleApplier,Permit.get=function(name){return PermitRegistry.get(name)},prototype.init=function(){return this.debug("permit init"),this.applyRules(),this.configureMatchers(),this},prototype.configureMatchers=function(){var key;if(this.debug("configure-matchers",this.matchesOn),"Object"===toString$.call(this.matchesOn).slice(8,-1)){this.compiledList=[],this.debug("compile...");for(key in this.matchesOn)this.compileFor(key,this.matchesOn[key]);return this.debug("compiled matchers:",this.compiledList)}},prototype.compileFor=function(key,list){var fun;return this.debug("compile for",key,list),fun=this.compiledMatcher(key,list),this.debug("fun",fun),this.compiledList.push(fun)},prototype.compiledMatcher=function(type,matchList){var self;return self=this,function(accessRequest){var matchObj,ref$;return ref$={},ref$[type]=matchList,matchObj=ref$,self.debug("compiled fun: match-on",accessRequest),self.matchOn(accessRequest,matchObj)}},prototype.clean=function(){return this.ruleRepo.clean(),this.appliedRules=!1},prototype.use=function(obj){if("Function"===toString$.call(obj).slice(8,-1)&&(obj=obj()),"Object"===toString$.call(obj).slice(8,-1))return lo.extend(this,obj);throw Error("Can only extend permit with an Object, was: "+toString$.call(obj).slice(8,-1))},prototype.rules=function(){},prototype.permitAllower=function(){return new PermitAllower(this.ruleRepo,this.debugging)},prototype.allows=function(accessRequest){var res;return this.debug("permit allows?",this.name,this.description),res=this.permitAllower().allows(accessRequest),this.debug(this.name+" Permit allows:",this.rules,accessRequest,res),res},prototype.disallows=function(accessRequest){var res;return this.debug("permit disallows?",this.name,this.description),res=this.permitAllower().disallows(accessRequest),this.debug(this.name+" Permit disallows:",this.rules,accessRequest,res),res},prototype.matching=function(access){return new AccessMatcher(access)},prototype.matcher=function(accessRequest){return new this.permitMatcherClass(this,accessRequest,this.debugging)},prototype.matches=function(accessRequest){var permitMatcher;return this.debug("matches",accessRequest),permitMatcher=this.matcher(accessRequest),this.debug("permit matcher",permitMatcher),permitMatcher.match()},prototype.matchOn=function(accessRequest,matchObj){return this.matching(accessRequest).matchOn(matchObj)},prototype.matchUser=function(accessRequest,user){return this.matching(accessRequest).user(user)},prototype.matchRole=function(accessRequest,role){return this.matching(accessRequest).role(role)},prototype.matchSubject=function(accessRequest,subj){return this.matching(accessRequest).subject(subj)},prototype.matchSubjectClazz=function(){return{subjectClazz:this.matching(accessRequest).clazz}},prototype.matchAction=function(action){return this.matching(accessRequest).action(action)},prototype.matchContext=function(ctx){return this.matches(accessRequest).context(ctx)},prototype.matchCtx=function(ctx){return this.matching(accessRequest).ctx(ctx)},prototype.ruleApplier=function(accessRequest){return"Object"!==toString$.call(accessRequest).slice(8,-1)&&(accessRequest={}),new this.ruleApplierClass(this.ruleRepo,this.rules,accessRequest,this.debugging)},prototype.applyRules=function(accessRequest,force){return void 0!==accessRequest&&"Object"!==toString$.call(accessRequest).slice(8,-1)&&(force=Boolean(accessRequest)),!this.appliedRules||force?(this.debug("permit apply rules",accessRequest),this.ruleApplier(accessRequest).applyRules(),this.appliedRules=!0):this.debug("rules already applied before",this.appliedRules)},prototype.canRules=function(){return this.ruleRepo.canRules},prototype.cannotRules=function(){return this.ruleRepo.cannotRules},Permit}(Debugger),lo.extend(Permit,Debugger)}).call(this)},{"./debugger":10,"./matchers":17,"./permit/permit_allower":19,"./permit/permit_matcher":22,"./permit/permit_registry":23,"./rule/rule_applier":26,"./rule/rule_repo":27,"./util/lodash_lite":29}],19:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,PermitAllower,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),module.exports=PermitAllower=function(){function PermitAllower(ruleRepo,debugging){if(this.ruleRepo=ruleRepo,this.debugging=debugging,"Object"!==toString$.call(this.ruleRepo).slice(8,-1))throw Error("PermitAllower must take a RuleRepo in constructor, was: "+this.ruleRepo)}PermitAllower.displayName="PermitAllower";var prototype=PermitAllower.prototype;return importAll$(prototype,arguments[0]),prototype.testAccess=function(act,accessRequest){var subj;return this.debug("test-access",act,accessRequest),this.debugging&&this.ruleRepo.debugOn(),subj=this.ruleRepo.matchRule(act,accessRequest),this.debug("subj",subj),subj===!0},prototype.allows=function(accessRequest,ignoreInverse){return this.debug("allows",accessRequest,ignoreInverse),!ignoreInverse&&this.disallows(accessRequest,!0)?!1:this.testAccess("can",accessRequest)===!1?!1:!0},prototype.disallows=function(accessRequest,ignoreInverse){return this.debug("disallows",accessRequest,ignoreInverse),this.testAccess("cannot",accessRequest)===!0?!0:!1},PermitAllower}(Debugger),lo.extend(PermitAllower,Debugger)}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],20:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,Permit,PermitRegistry,PermitFilter,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),Permit=require("../permit"),PermitRegistry=require("../permit/permit_registry"),module.exports=PermitFilter=function(){function PermitFilter(){}PermitFilter.displayName="PermitFilter";var prototype=PermitFilter.prototype;return importAll$(prototype,arguments[0]),PermitFilter.filter=function(accessRequest){var self,matchingFun,permits,res;if(self=this,matchingFun=function(permit){if(self.debug("matching",permit,accessRequest),!permit.matches)throw Error("Permit must have a .matches(access-request) method: "+permit);return permit.matches(accessRequest)},permits=this.permits(),"Array"!==toString$.call(permits).slice(8,-1))throw Error("permits which contain all registered permits, must be an Array, was: "+typeof permits);return this.debug("filter permits",permits,accessRequest),res=lo.filter(permits,matchingFun),this.debug("filtered",res),res},PermitFilter.permits=function(){return lo.values(PermitRegistry.permits)},PermitFilter}(Debugger),lo.extend(PermitFilter,Debugger)}).call(this)
},{"../debugger":10,"../permit":18,"../permit/permit_registry":23,"../util/lodash_lite":29}],21:[function(require,module){(function(){var lo,Permit,toString$={}.toString;lo=require("../util/lodash_lite"),Permit=require("../permit"),module.exports=function(baseClazz,name,baseObj,debug){var permit;return"String"===toString$.call(baseClazz).slice(8,-1)&&(baseObj=name,name=baseClazz,baseClazz=Permit),permit=new baseClazz(name),debug===!0&&permit.debugOn(),null!=baseObj&&"Function"===toString$.call(baseObj).slice(8,-1)&&(baseObj=baseObj()),"Object"===toString$.call(baseObj).slice(8,-1)&&(permit=permit.use(baseObj)),permit.init()}}).call(this)},{"../permit":18,"../util/lodash_lite":29}],22:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Intersect,AccessMatcher,Debugger,PermitMatcher,toString$={}.toString;lo=require("../util/lodash_lite"),Intersect=require("../util/intersect"),AccessMatcher=require("../matcher/access_matcher"),Debugger=requires.lib("debugger"),module.exports=PermitMatcher=function(){function PermitMatcher(permit,accessRequest,debugging){this.permit=permit,this.accessRequest=accessRequest,this.debugging=debugging,this.intersect=Intersect(),this.debugging&&this.debugOn(),this.validate()}PermitMatcher.displayName="PermitMatcher";var prototype=PermitMatcher.prototype;return importAll$(prototype,arguments[0]),prototype.match=function(options){var res,mc;return null==options&&(options={}),this.debug("permit-matcher match"),res=(this.include()||this.customMatch())&&!(this.exclude()||this.customExMatch()),options.compiled===!1?res:(this.debug("compiled result:",this.matchCompiled()),mc=this.matchCompiled(),this.debug("mc res",mc),res||mc)},prototype.matchCompiled=function(){var res,i$,ref$,len$,matchFun;if(this.debug("match-compiled",this.permit.compiledList),"Array"!==toString$.call(this.permit.compiledList).slice(8,-1))return!1;for(this.debug("compiled matchers: "+this.permit.compiledList.length),res=!1,i$=0,len$=(ref$=this.permit.compiledList).length;len$>i$&&(matchFun=ref$[i$],matchFun(this.accessRequest)&&(res=!0),this.debug("compile fun res",res),!res);++i$);return res},prototype.include=function(){return this.intersectOn(this.permit.includes)},prototype.exclude=function(){return this.intersectOn(this.permit.excludes)},prototype.customExMatch=function(){var res;if("Function"===toString$.call(this.permit.exMatch).slice(8,-1)){if(res=this.permit.exMatch(this.accessRequest),res.constructor===AccessMatcher)return res.result();if(void 0===res)return!0;if("Boolean"!==toString$.call(res).slice(8,-1))throw Error(".match method of permit "+this.permit.name+" must return a Boolean value, was: "+toString$.call(res).slice(8,-1));return res}return this.debug("permit.ex-match function not found for permit: "+this.permit),!1},prototype.customMatch=function(){var res;if("Function"===toString$.call(this.permit.match).slice(8,-1)){if(res=this.permit.match(this.accessRequest),this.debug("custom-match",this.permit.match,res),res.constructor===AccessMatcher)return res.result();if(void 0===res)return!0;if("Boolean"!==toString$.call(res).slice(8,-1))throw Error(".match method of permit "+this.permit.name+" must return a Boolean value, was: "+toString$.call(res).slice(8,-1));return res}return this.debug("permit.match function not found for permit: "+this.permit),!1},prototype.intersectOn=function(partial){var res;return null==partial?!1:("Function"===toString$.call(partial).slice(8,-1)&&(partial=partial()),res=this.intersect.on(partial,this.accessRequest))},prototype.validate=function(){if(!this.permit)throw Error("PermitMatcher missing permit");if(null!=this.accessRequest&&void 0===this.accessRequest)throw Error("access-request is undefined")},PermitMatcher}(Debugger),lo.extend(PermitMatcher,Debugger)}).call(this)},{"../matcher/access_matcher":11,"../util/intersect":28,"../util/lodash_lite":29}],23:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,todo,PermitRegistry,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),todo="allow creation of multiple registries and select one to use per environment",module.exports=PermitRegistry=function(){function PermitRegistry(){throw Error("PermitRegistry is currently a singleton (TODO: "+todo+")")}PermitRegistry.displayName="PermitRegistry";var prototype=PermitRegistry.prototype,constructor=PermitRegistry;return importAll$(prototype,arguments[0]),PermitRegistry.permits={},PermitRegistry.permitCounter=0,PermitRegistry.calcName=function(name){if(void 0===name&&(name="Permit-"+constructor.permitCounter),"String"!==toString$.call(name).slice(8,-1))throw Error("Name of permit must be a String, was: "+name);return name},PermitRegistry.get=function(name){return constructor.permits[name]||function(){throw Error("No permit '"+name+"' is registered")}()},PermitRegistry.registerPermit=function(permit){var name;if(permit.name=this.calcName(permit.name),name=permit.name,"Object"!==toString$.call(constructor.permits).slice(8,-1))throw Error("permits registry container must be an Object in order to store permits by name, was: "+constructor.permits);if(constructor.permits[name])throw Error("A Permit named: "+name+" is already registered, please use a different name!");return constructor.permits[name]=permit,constructor.permitCounter=constructor.permitCounter+1},PermitRegistry.clearPermits=function(){return constructor.permits={},constructor.permitCounter=0},PermitRegistry.clearAll=function(){return constructor.clearPermits()},PermitRegistry.permitList=function(){return lo.values(constructor.permits)},PermitRegistry.cleanPermits=function(){var i$,ref$,len$,permit,results$=[];for(i$=0,len$=(ref$=constructor.permitList()).length;len$>i$;++i$)permit=ref$[i$],results$.push(permit.clean());return results$},PermitRegistry.cleanAll=function(){return constructor.cleanPermits()},PermitRegistry}(Debugger),lo.extend(PermitRegistry,Debugger)}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],24:[function(require,module){(function(){function extend$(sub,sup){function fun(){}return fun.prototype=(sub.superclass=sup).prototype,(sub.prototype=new fun).constructor=sub,"function"==typeof sup.extended&&sup.extended(sub),sub}function import$(obj,src){var own={}.hasOwnProperty;for(var key in src)own.call(src,key)&&(obj[key]=src[key]);return obj}function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,PermitRulesDbLoader;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),PermitRulesDbLoader=function(superclass){function PermitRulesDbLoader(filePath){this.filePath=filePath,PermitRulesDbLoader.superclass}var prototype=extend$((import$(PermitRulesDbLoader,superclass).displayName="PermitRulesDbLoader",PermitRulesDbLoader),superclass).prototype;return importAll$(prototype,arguments[1]),prototype.loadDb=function(options){return this.options=null!=options?options:{},this.connectDb(),this.loadData(),this.loadedRules=JSON.parse(data),this.processRules()},prototype.connectDb=function(){},prototype.loadData=function(){},PermitRulesDbLoader}(PermitRulesLoader,Debugger),module.exports=PermitRulesDbLoader}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],25:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,fs,permitFor,PermitRulesLoader,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),fs=require("fs"),permitFor=require("../permit/permit_for"),Array.prototype.contains=function(v){return this.indexOf(v)>-1},PermitRulesLoader=function(){function PermitRulesLoader(filePath,options){this.filePath=filePath,this.options=null!=options?options:{},this.loadedRules={},this.async=this.options.async}PermitRulesLoader.displayName="PermitRulesLoader";var prototype=PermitRulesLoader.prototype;return importAll$(prototype,arguments[0]),prototype.createPermit=function(name,options){var baseClazz,loadedRules,permit;return null==options&&(options={}),baseClazz||(baseClazz=options.clazz||requires.lib("permit")),loadedRules=this.loadRules().rules(),console.log("loaded-rules",loadedRules,this.filePath),permit=permitFor(baseClazz,name,function(){return{rules:{}}}),options.key?permit.rules[key]=loadedRules:permit.rules=loadedRules},prototype.loadRules=function(filePath,async){if(this.filePath||(this.filePath=filePath),void 0!==async?this.async=async:this.async||(this.async=!0),this.debug("loadRules",this.filePath),!this.filePath)throw Error("Error: Missing filepath");return this.async?this.loadRulesAsync(filePath):this.loadRulesSync(filePath)},prototype.loadRulesAsync=function(){var self;return this.debug("loadRulesAsync"),self=this,fs.readFile(this.filePath,"utf8",function(err,data){var rules;if(self.debug(err,data),err)throw this.debug(err),Error("Error loading file: "+this.filePath+" - "+err);return self.debug("data",data),rules=JSON.parse(data),self.debug("loaded-rules",rules),self.loadedRules=rules,self.processRules()}),this},prototype.loadRulesSync=function(){var data,rules,err;try{if(data=fs.readFileSync(this.filePath,"utf8",function(){}),this.debug("data",data),"String"!==toString$.call(data).slice(8,-1))throw Error;return rules=JSON.parse(data),this.debug("loaded-rules",rules),this.loadedRules=rules,this.processRules(),this}catch(e$){throw err=e$,Error("Error loading file: "+this.filePath+" - "+err)}},prototype.loadRulesFrom=function(path){return this.loadRules(path)},prototype.load=function(path){return this.loadRules(path)},prototype.processRules=function(){var key,ref$,rule;if(this.debug("processRules",this.loadedRules),"Object"!==toString$.call(this.loadedRules).slice(8,-1))throw Error("Rules not loaded or invalid: "+this.loadedRules);this.processedRules={};for(key in ref$=this.loadedRules)rule=ref$[key],this.processRule(key,rule);return this.processedRules},prototype.processRule=function(key,rule){return this.debug("processRule",key,rule),this.processedRules[key]=this.ruleFor(rule)},prototype.createRulesAt=function(permit,place){if("Function"!==toString$.call(permit).slice(8,-1))throw Error("Not a permit, was: "+permit);if(null!=place){if(null==permit.rules||"Object"!==toString$.call(permit.rules).slice(8,-1))throw Error("Permit has no rules object to place loaded rules at "+place);return permit.rules[place]=this.processedRules}return permit.rules=this.processedRules},prototype.rules=function(){return this.processedRules},prototype.ruleFor=function(rule){var key;if(this.debug("ruleFor",rule),key=Object.keys(rule)[0],!["can","cannot"].contains(key))throw Error("Not a valid rule key, must be 'can' or 'cannot', was: "+key);return this.factory(key,rule[key])},prototype.factory=function(act,rule){var rules,action,subject,fun;rules=[];for(action in rule)subject=rule[action],fun=this.resolve(act,action,subject),rules.push(fun);return function(){var i$,ref$,len$,rule,results$=[];for(i$=0,len$=(ref$=rules).length;len$>i$;++i$)rule=ref$[i$],results$.push(this.rule());return results$}},prototype.resolve=function(act,action,subject){return function(){return this["u"+act](action,subject)}},PermitRulesLoader}(Debugger),module.exports=PermitRulesLoader}).call(this)},{"../debugger":10,"../permit/permit_for":21,"../util/lodash_lite":29,fs:1}],26:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,recurse,valid_rules,RuleApplier,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),recurse=function(val,ctx){var k,results$=[];switch(toString$.call(val).slice(8,-1)){case"Function":return val.call(ctx);case"Object":for(k in val)results$.push(recurse(k,ctx));return results$}},valid_rules=function(rules){return"Object"===toString$.call(rules).slice(8,-1)||"Function"===toString$.call(rules).slice(8,-1)},module.exports=RuleApplier=function(){function RuleApplier(repo,rules,accessRequest,debugging){if(this.repo=repo,this.rules=rules,this.accessRequest=accessRequest,this.debugging=debugging,"Object"!==toString$.call(this.repo).slice(8,-1))throw Error("RuleApplier must be passed a RuleRepo, was: "+this.repo);if(!valid_rules(this.rules))throw Error("RuleApplier must be passed the rules to be applied, was: "+this.rules);if(void 0!==this.accessRequest&&"Object"!==toString$.call(this.accessRequest).slice(8,-1))throw Error("AccessRequest must be an Object, was: "+this.accessRequest);this.debugging=this.debugging}RuleApplier.displayName="RuleApplier";var prototype=RuleApplier.prototype;return importAll$(prototype,arguments[0]),prototype.action=function(){var ref$;return null!=(ref$=this.accessRequest)?ref$.action:void 0},prototype.user=function(){var ref$;return null!=(ref$=this.accessRequest)?ref$.user:void 0},prototype.subject=function(){var ref$;return null!=(ref$=this.accessRequest)?ref$.subject:void 0},prototype.ctx=function(){var ref$;return null!=(ref$=this.accessRequest)?ref$.ctx:void 0},prototype.canRules=function(){return this.repo.canRules},prototype.cannotRules=function(){return this.repo.cannotRules},prototype.applyRulesFor=function(name,context){var rules,namedRules;return this.debug("apply rules for "+name+" in context: "+context),"Object"===toString$.call(name).slice(8,-1)&&this.applyObjRulesFor(name,context),"String"!==toString$.call(name).slice(8,-1)?(this.debug("Name to apply rules for must be a String, was: "+typeof name+" : "+name),this):(rules=this.contextRules(context),namedRules=rules[name],"Function"===toString$.call(namedRules).slice(8,-1)?namedRules.call(this,this.accessRequest):this.debug("rules key for "+name+" should be a function that resolves one or more rules"),this)},prototype.applyObjRulesFor=function(obj,context){var rules,objKeys,key,val,keyRules,results$=[];rules=this.contextRules(context),this.debug("apply-obj-rules-for",obj,context,rules),objKeys=Object.keys(obj),"User"===obj.clazz&&(objKeys=["name","role"]);for(key in objKeys)val=obj[key],"User"===obj.clazz&&this.applyRulesFor(val,context),keyRules=rules[key],results$.push(this.applyRulesFor(val,keyRules));return results$},prototype.contextRules=function(context){return"Object"===toString$.call(context).slice(8,-1)?context:"String"!==toString$.call(context).slice(8,-1)?this.rules:"Object"===toString$.call(this.rules[context]).slice(8,-1)?this.rules[context]:(this.debug("no such rules context: "+context,this.rules),this.rules)},prototype.applyActionRules=function(){return this.applyRulesFor(this.action()),this.applyRulesFor(this.action(),"action"),this},prototype.applyUserRules=function(){return this.applyRulesFor(this.user()),this.applyRulesFor(this.user(),"user"),this},prototype.applySubjectRules=function(){return this.applyRulesFor(this.subject()),this.applyRulesFor(this.subject(),"subject"),this},prototype.applyCtxRules=function(){return this.applyRulesFor(this.ctx()),this.applyRulesFor(this.ctx(),"ctx"),this.applyRulesFor(this.ctx(),"context"),this},prototype.applyContextRules=function(){return this.applyCtxRules()},prototype.validRequest=function(){return!lo.isEmpty(this.accessRequest)},prototype.applyDefaultRules=function(){return this.debug("apply-default-rules",this.accessRequest,this.validRequest()),"Object"===toString$.call(this.accessRequest).slice(8,-1)&&this.validRequest()?this.applyAccessRules():this.applyRulesFor("default"),this},prototype.applyRules=function(){if(!valid_rules(this.rules))return void this.debug("invalid permit rules could not be applied");switch(this.debug("applying rules",this.rules,"for",this.accessRequest),typeof this.rules){case"function":this.rules();break;case"object":this.applyDefaultRules();break;default:throw Error("rules must be a Function or an Object, was: "+this.rules)}return this},prototype.applyAccessRules=function(){return this.debug("apply access rules on",this.accessRequest),this.applyActionRules(),this.applyUserRules(),this.applyCtxRules(),this},prototype.applyAllRules=function(){var rules,ctx,self,key;switch(typeof this.rules){case"object":rules=this.rules,ctx=this,self=this;for(key in rules)self.recurse(rules[key],ctx);break;default:throw Error("rules must be an Object was: "+typeof this.rules)}return this},prototype.ucan=function(actions,subjects,ctx){return this.repo.registerRule("can",actions,subjects,ctx)},prototype.ucannot=function(actions,subjects,ctx){return this.repo.registerRule("cannot",actions,subjects,ctx)},RuleApplier}(Debugger),lo.extend(RuleApplier,Debugger)}).call(this)},{"../debugger":10,"../util/lodash_lite":29}],27:[function(require,module){(function(){function importAll$(obj,src){for(var key in src)obj[key]=src[key];return obj}var lo,Debugger,camelCase,normalize,RuleRepo,toString$={}.toString;lo=require("../util/lodash_lite"),Debugger=require("../debugger"),camelCase=require("../util/string_util").camelCase,normalize=require("../util/normalize"),module.exports=RuleRepo=function(){function RuleRepo(name){this.name=name}RuleRepo.displayName="RuleRepo";var prototype=RuleRepo.prototype;return importAll$(prototype,arguments[0]),prototype.canRules={},prototype.cannotRules={},prototype.display=function(){return console.log("name:",this.name),console.log("can-rules:",this.canRules),console.log("cannot-rules:",this.cannotRules)},prototype.cleanAll=function(){return this.clean("can"),this.clean("cannot"),this},prototype.clean=function(act){if(void 0===act)return this.cleanAll();if("can"!==act&&"cannot"!==act)throw Error("Repo can only clear 'can' or 'cannot' rules, was: "+act);return this.debug("clean",act),this[act+"Rules"]={},this},prototype.clearAll=function(){return this.cleanAll()},prototype.clear=function(act){return this.clean(act)},prototype.subjectClazz=function(subject){var subjectClazz;return subjectClazz="Object"===toString$.call(subject).slice(8,-1)?subject.constructor.displayName:subject},prototype.wildcards=["*","any"],prototype.findMatchingSubject=function(subjects,subject){var self,camelized;if(lo.find(this.wildcards,function(wildcard){return-1!==subjects.indexOf(wildcard)}))return!0;if("Array"===toString$.call(subject).slice(8,-1))return self=this,lo.find(subject,function(subj){return self.findMatchingSubject(subjects,subj)});if("String"!==toString$.call(subject).slice(8,-1))throw Error("find-matching-subject: Subject must be a String to be matched, was "+subject);return camelized=camelCase(subject),-1!==subjects.indexOf(camelized)},prototype.matchRule=function(act,accessRequest){var action,subject,subjClazz,ruleContainer,actionSubjects;return this.debug("match-rule",act,accessRequest),act=camelCase(act),action=accessRequest.action,subject=accessRequest.subject,subjClazz=this.subjectClazz(subject),ruleContainer=this.containerFor(act),"manage"===action&&this.matchManageRule(ruleContainer,subjClazz),this.debug("subj-clazz",subjClazz),subjClazz&&(actionSubjects=ruleContainer[action])?this.matchSubjectClazz(actionSubjects,subjClazz):void 0},prototype.matchSubjectClazz=function(actionSubjects,subjClazz){return this.debug("match-subject-clazz",actionSubjects,subjClazz),"Array"!==toString$.call(actionSubjects).slice(8,-1)?!1:this.findMatchingSubject(actionSubjects,subjClazz)},prototype.matchManageRule=function(ruleContainer,subjClazz){var manageSubjects,found;return manageSubjects=ruleContainer.manage,found=matchSubjectClazz(manageSubjects,subjClazz),found?found:manageActionSubjects(ruleContainer).all(function(actionSubjects){return matchSubjectClazz(actionSubjects,subjClazz)})},prototype.manageActionSubjects=function(ruleContainer){return lo.map(this.manageActions(),function(action){return ruleContainer[action]})},prototype.manageActions=function(){return["create","edit","delete"]},prototype.addRule=function(ruleContainer,action,subjects){var ruleSubjects,uniqueSubjects,actionSubjects,self;if("Object"!==toString$.call(ruleContainer).slice(8,-1))throw Error("Container must be an object");return ruleSubjects=ruleContainer[action]||[],subjects=normalize(subjects),ruleSubjects=ruleSubjects.concat(subjects),ruleSubjects=lo.map(ruleSubjects,function(subject){var val;return val=camelCase(subject),"Any"===val?"*":val}),uniqueSubjects=lo.unique(ruleSubjects),actionSubjects=ruleContainer[action],"Array"!==toString$.call(actionSubjects).slice(8,-1)&&(actionSubjects=[]),ruleContainer[action]=this.registerActionSubjects(actionSubjects,uniqueSubjects),"manage"===action?(self=this,lo.each(this.manageActions(),function(action){return ruleContainer[action]=self.registerActionSubjects(actionSubjects,uniqueSubjects)})):void 0},prototype.registerActionSubjects=function(actionContainer,subjects){return lo.unique(actionContainer.concat(subjects))},prototype.containerFor=function(act){var c;if(act=act.toLowerCase(),c=this[act+"Rules"],"Object"!==toString$.call(c).slice(8,-1))throw Error("No valid rule container for: "+act);return c},prototype.registerRule=function(act,actions,subjects){var ruleContainer,i$,len$,action,results$=[];for(actions=normalize(actions),ruleContainer=this.containerFor(act),i$=0,len$=actions.length;len$>i$;++i$)action=actions[i$],results$.push(this.addRule(ruleContainer,action,subjects));return results$},RuleRepo}(Debugger),lo.extend(RuleRepo,Debugger)}).call(this)},{"../debugger":10,"../util/lodash_lite":29,"../util/normalize":30,"../util/string_util":31}],28:[function(require,module){(function(){var lo,toString$={}.toString;lo=require("./lodash_lite"),module.exports=function(){var countProps,objectEquals,recursivePartialEqual;return countProps=function(obj){var count,i$,len$,k;for(count=0,i$=0,len$=obj.length;len$>i$;++i$)k=obj[i$],obj.hasOwnProperty(k)&&count++;return count},objectEquals=function(v1,v2){var r,i$,len$,k;if(typeof v1!=typeof v2)return!1;if("Object"===toString$.call(v1).slice(8,-1)&&"Object"===toString$.call(v2).slice(8,-1)){if(countProps(v1)!==countProps(v2))return!1;for(r=!0,i$=0,len$=v1.length;len$>i$;++i$)if(k=v1[i$],r=objectEquals(v1[k],v2[k]),!r)return!1;return!0}return v1===v2},recursivePartialEqual=function(partialObj,compareObj){var res,key,partial,compare,equals;if(res={},void 0===partialObj||void 0===compareObj)return!1;for(key in partialObj)res[key]=!1,partial=partialObj[key],compare=compareObj[key],void 0!==partial&&("Object"===toString$.call(partial).slice(8,-1)&&"Object"===toString$.call(compare).slice(8,-1)?null!=compare&&(equals=recursivePartialEqual(partial,compare)):equals=objectEquals(partial,compare),equals&&(res[key]=!0));for(key in partialObj)if(!res[key])return!1;return!0},{on:function(partial,obj){return recursivePartialEqual(partial,obj)}}}}).call(this)},{"./lodash_lite":29}],29:[function(require,module,exports){(function(global){(function(){function N(a,c,b){b=(b||0)-1;for(var d=a?a.length:0;++b<d;)if(a[b]===c)return b;return-1}function Ja(a,c){var b=typeof c;if(a=a.l,"boolean"==b||null==c)return a[c]?0:-1;"number"!=b&&"string"!=b&&(b="object");var d="number"==b?c:ja+c;return a=(a=a[b])&&a[d],"object"==b?a&&-1<N(a,c)?0:-1:a?0:-1}function Ka(a){var c=this.l,b=typeof a;if("boolean"==b||null==a)c[a]=!0;else{"number"!=b&&"string"!=b&&(b="object");var d="number"==b?a:ja+a,c=c[b]||(c[b]={});"object"==b?(c[d]||(c[d]=[])).push(a):c[d]=!0}}function ka(){return Y.pop()||{k:null,l:null,"false":!1,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1}}function O(a){a.length=0,D.length<la&&D.push(a)}function ma(a){var c=a.l;c&&ma(c),a.k=a.l=a.object=a.number=a.string=null,Y.length<la&&Y.push(a)}function y(a,c){var b;c||(c=0),"undefined"==typeof b&&(b=a?a.length:0);var d=-1;b=b-c||0;for(var e=Array(0>b?0:b);++d<b;)e[d]=a[c+d];return e}function f(){}function La(a){function c(){if(d){var a=y(d);P.apply(a,arguments)}if(this instanceof c){var l=$(b.prototype),a=b.apply(l,a||arguments);return z(a)?a:l}return b.apply(e,a||arguments)}var b=a[0],d=a[2],e=a[4];return aa(c,a),c}function $(a){return z(a)?Q(a):{}}function na(a,c,b){if("function"!=typeof a)return ba;if("undefined"==typeof c||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(g.funcNames&&(d=!a.name),d=d||!g.funcDecomp,!d)){var e=Ma.call(a);g.funcNames||(d=!Na.test(e)),d||(d=oa.test(e),aa(a,d))}if(!1===d||!0!==d&&1&d[1])return a;switch(b){case 1:return function(b){return a.call(c,b)};case 2:return function(b,d){return a.call(c,b,d)};case 3:return function(b,d,e){return a.call(c,b,d,e)};case 4:return function(b,d,e,f){return a.call(c,b,d,e,f)}}return pa(a,c)}function qa(a){function c(){var a=m?l:this;if(e){var s=y(e);P.apply(s,arguments)}return(Z||h)&&(s||(s=y(arguments)),Z&&P.apply(s,Z),h&&s.length<f)?(d|=16,qa([b,g?d:-4&d,s,null,l,f])):(s||(s=arguments),p&&(b=a[n]),this instanceof c?(a=$(b.prototype),s=b.apply(a,s),z(s)?s:a):b.apply(a,s))}var b=a[0],d=a[1],e=a[2],Z=a[3],l=a[4],f=a[5],m=1&d,p=2&d,h=4&d,g=8&d,n=b;return aa(c,a),c}function ra(a,c,b){for(var d=-1,e=a?a.length:0,f=[];++d<e;){var l=a[d];if(l&&"object"==typeof l&&"number"==typeof l.length&&(A(l)||w(l))){c||(l=ra(l,c,b));var q=-1,m=l.length,p=f.length;for(f.length+=m;++q<m;)f[p++]=l[q]}else b||f.push(l)}return f}function E(a,c,b,d,e,f){if(b){var l=b(a,c);if("undefined"!=typeof l)return!!l}if(a===c)return 0!==a||1/a==1/c;if(a===a&&!(a&&x[typeof a]||c&&x[typeof c]))return!1;if(null==a||null==c)return a===c;var q=u.call(a),m=u.call(c);if(q==F&&(q=G),m==F&&(m=G),q!=m)return!1;switch(q){case sa:case ta:return+a==+c;case ua:return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case va:case H:return a==String(c)}if(m=q==R,!m){var p=v.call(a,"__wrapped__"),h=v.call(c,"__wrapped__");if(p||h)return E(p?a.__wrapped__:a,h?c.__wrapped__:c,b,d,e,f);if(q!=G)return!1;if(q=!g.argsObject&&w(a)?Object:a.constructor,p=!g.argsObject&&w(c)?Object:c.constructor,q!=p&&!(B(q)&&q instanceof q&&B(p)&&p instanceof p)&&"constructor"in a&&"constructor"in c)return!1}for(q=!e,e||(e=D.pop()||[]),f||(f=D.pop()||[]),p=e.length;p--;)if(e[p]==a)return f[p]==c;var n=0,l=!0;if(e.push(a),f.push(c),m){if(p=a.length,n=c.length,(l=n==p)||d)for(;n--;)if(m=p,h=c[n],d)for(;m--&&!(l=E(a[m],h,b,d,e,f)););else if(!(l=E(a[n],h,b,d,e,f)))break}else ca(c,function(c,h,m){return v.call(m,h)?(n++,l=v.call(a,h)&&E(a[h],c,b,d,e,f)):void 0}),l&&!d&&ca(a,function(a,c,b){return v.call(b,c)?l=-1<--n:void 0});return e.pop(),f.pop(),q&&(O(e),O(f)),l}function da(a,c,b,d,e,f){var l=1&c,q=4&c,m=16&c,p=32&c;if(!(2&c||B(a)))throw new TypeError;m&&!b.length&&(c&=-17,m=b=!1),p&&!d.length&&(c&=-33,p=d=!1);var h=a&&a.__bindData__;return h&&!0!==h?(h=y(h),h[2]&&(h[2]=y(h[2])),h[3]&&(h[3]=y(h[3])),!l||1&h[1]||(h[4]=e),!l&&1&h[1]&&(c|=8),!q||4&h[1]||(h[5]=f),m&&P.apply(h[2]||(h[2]=[]),b),p&&Oa.apply(h[3]||(h[3]=[]),d),h[1]|=c,da.apply(null,h)):(1==c||17===c?La:qa)([a,c,b,d,e,f])}function I(){r.h=ea,r.b=r.c=r.g=r.i="",r.e="t",r.j=!0;for(var a,c=0;a=arguments[c];c++)for(var b in a)r[b]=a[b];c=r.a,r.d=/^[^,]+/.exec(c)[0],a=Function,c="return function("+c+"){",b=r;var d="var n,t="+b.d+",E="+b.e+";if(!t)return E;"+b.i+";";b.b?(d+="var u=t.length;n=-1;if("+b.b+"){",g.unindexedChars&&(d+="if(s(t)){t=t.split('')}"),d+="while(++n<u){"+b.g+";}}else{"):g.nonEnumArgs&&(d+="var u=t.length;n=-1;if(u&&p(t)){while(++n<u){n+='';"+b.g+";}}else{"),g.enumPrototypes&&(d+="var G=typeof t=='function';"),g.enumErrorProps&&(d+="var F=t===k||t instanceof Error;");var e=[];if(g.enumPrototypes&&e.push('!(G&&n=="prototype")'),g.enumErrorProps&&e.push('!(F&&(n=="message"||n=="name"))'),b.j&&b.f)d+="var C=-1,D=B[typeof t]&&v(t),u=D?D.length:0;while(++C<u){n=D[C];",e.length&&(d+="if("+e.join("&&")+"){"),d+=b.g+";",e.length&&(d+="}"),d+="}";else if(d+="for(n in t){",b.j&&e.push("m.call(t, n)"),e.length&&(d+="if("+e.join("&&")+"){"),d+=b.g+";",e.length&&(d+="}"),d+="}",g.nonEnumShadows){for(d+="if(t!==A){var i=t.constructor,r=t===(i&&i.prototype),f=t===J?I:t===k?j:L.call(t),x=y[f];",k=0;7>k;k++)d+="n='"+b.h[k]+"';if((!(r&&x[n])&&m.call(t,n))",b.j||(d+="||(!x[n]&&t[n]!==A[n])"),d+="){"+b.g+"}";d+="}"}return(b.b||g.nonEnumArgs)&&(d+="}"),d+=b.c+";return E",a("d,j,k,m,o,p,q,s,v,A,B,y,I,J,L",c+d+"}")(na,wa,fa,v,Pa,w,A,xa,r.f,S,x,n,H,Qa,u)}function J(a){return"function"==typeof a&&Ra.test(a)}function w(a){return a&&"object"==typeof a&&"number"==typeof a.length&&u.call(a)==F||!1}function B(a){return"function"==typeof a}function z(a){return!(!a||!x[typeof a])}function xa(a){return"string"==typeof a||a&&"object"==typeof a&&u.call(a)==H||!1}function ya(a,c,b){var d=[];if(c=f.createCallback(c,b,3),A(a)){b=-1;for(var e=a.length;++b<e;){var g=a[b];c(g,b,a)&&d.push(g)}}else T(a,function(a,b,e){c(a,b,e)&&d.push(a)});return d}function ga(a,c,b){if(c=f.createCallback(c,b,3),!A(a)){var g;return T(a,function(a,b,d){return c(a,b,d)?(g=a,!1):void 0}),g}b=-1;for(var d=a.length;++b<d;){var e=a[b];if(c(e,b,a))return e}}function za(a,c,b){if(c&&"undefined"==typeof b&&A(a)){b=-1;for(var d=a.length;++b<d&&!1!==c(a[b],b,a););}else T(a,c,b);return a}function ha(a,c,b){var d=-1,e=a?a.length:0,g=Array("number"==typeof e?e:0);if(c=f.createCallback(c,b,3),A(a))for(;++d<e;)g[d]=c(a[d],d,a);else T(a,function(a,b,e){g[++d]=c(a,b,e)});return g}function Aa(a,c,b){if("number"==typeof b){var d=a?a.length:0;b=0>b?Sa(0,d+b):b||0}else if(b)return b=Ba(a,c),a[b]===c?b:-1;return N(a,c,b)}function Ba(a,c,b,d){var e=0,g=a?a.length:e;for(b=b?f.createCallback(b,d,1):ba,c=b(c);g>e;)d=e+g>>>1,b(a[d])<c?e=d+1:g=d;return e}function Ca(a,c,b,d){"boolean"!=typeof c&&null!=c&&(d=b,b="function"!=typeof c&&d&&d[c]===a?null:c,c=!1),null!=b&&(b=f.createCallback(b,d,3)),d=-1;var e,g=(g=f.indexOf)===Aa?N:g;e=g;var g=a?a.length:0,l=[],q=!c&&g>=Ta&&e===N,m=b||q?D.pop()||[]:l;if(q){e=m;var m=-1,p=e.length,h=e[0],n=e[p/2|0],r=e[p-1];if(h&&"object"==typeof h&&n&&"object"==typeof n&&r&&"object"==typeof r)m=!1;else{for(h=ka(),h["false"]=h["null"]=h["true"]=h.undefined=!1,n=ka(),n.k=e,n.l=h,n.push=Ka;++m<p;)n.push(e[m]);m=n}e=Ja}for(;++d<g;)p=a[d],h=b?b(p,d,a):p,(c?!d||m[m.length-1]!==h:0>e(m,h))&&((b||q)&&m.push(h),l.push(p));return q?(O(m.k),ma(m)):b&&O(m),l}function pa(a,c){return 2<arguments.length?da(a,17,y(arguments,2),null,c):da(a,1,null,null,c)}function ba(a){return a}function Da(){}function Ea(a){return function(c){return c[a]}}var D=[],Y=[],Pa={},ja=+new Date+"",Ta=75,la=40,Na=/^\s*function[ \n\r\t]+\w/,oa=/\bthis\b/,ea="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),F="[object Arguments]",R="[object Array]",sa="[object Boolean]",ta="[object Date]",wa="[object Error]",ua="[object Number]",G="[object Object]",va="[object RegExp]",H="[object String]",Fa={configurable:!1,enumerable:!1,value:null,writable:!1},r={a:"",b:null,c:"",d:"",e:"",v:null,g:"",h:null,support:null,i:"",j:!1},x={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},K=x[typeof window]&&window||this,U=x[typeof exports]&&exports&&!exports.nodeType&&exports,V=x[typeof module]&&module&&!module.nodeType&&module,Ua=V&&V.exports===U&&U,t=x[typeof global]&&global;!t||t.global!==t&&t.window!==t||(K=t);var ia=[],fa=Error.prototype,S=Object.prototype,Qa=String.prototype,u=S.toString,Ra=RegExp("^"+String(u).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Ma=Function.prototype.toString,v=S.hasOwnProperty,P=ia.push,W=S.propertyIsEnumerable,Oa=ia.unshift,Ga=function(){try{var a={},c=J(c=Object.defineProperty)&&c,b=c(a,a,a)&&c}catch(d){}return b}(),Q=J(Q=Object.create)&&Q,C=J(C=Array.isArray)&&C,X=J(X=Object.keys)&&X,Sa=Math.max,n={};n[R]=n[ta]=n[ua]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},n[sa]=n[H]={constructor:!0,toString:!0,valueOf:!0},n[wa]=n["[object Function]"]=n[va]={constructor:!0,toString:!0},n[G]={constructor:!0},function(){for(var a=ea.length;a--;){var b,c=ea[a];for(b in n)v.call(n,b)&&!v.call(n[b],c)&&(n[b][c]=!1)}}();var g=f.support={};!function(){function a(){this.x=1}var c={0:1,length:1},b=[];a.prototype={valueOf:1,y:1};for(var d in new a)b.push(d);for(d in arguments);g.argsClass=u.call(arguments)==F,g.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),g.enumErrorProps=W.call(fa,"message")||W.call(fa,"name"),g.enumPrototypes=W.call(a,"prototype"),g.funcDecomp=!J(K.m)&&oa.test(function(){return this
}),g.funcNames="string"==typeof Function.name,g.nonEnumArgs=0!=d,g.nonEnumShadows=!/valueOf/.test(b),g.spliceObjects=(ia.splice.call(c,0,1),!c[0]),g.unindexedChars="xx"!="x"[0]+Object("x")[0]}(1),Q||($=function(){function a(){}return function(c){if(z(c)){a.prototype=c;var b=new a;a.prototype=null}return b||K.Object()}}());var aa=Ga?function(a,c){Fa.value=c,Ga(a,"__bindData__",Fa)}:Da;g.argsClass||(w=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&v.call(a,"callee")&&!W.call(a,"callee")||!1});var A=C||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&u.call(a)==R||!1},Ha=I({a:"z",e:"[]",i:"if(!(B[typeof z]))return E",g:"E.push(n)"}),L=X?function(a){return z(a)?g.enumPrototypes&&"function"==typeof a||g.nonEnumArgs&&a.length&&w(a)?Ha(a):X(a):[]}:Ha,t={a:"g,e,K",i:"e=e&&typeof K=='undefined'?e:d(e,K,3)",b:"typeof u=='number'",v:L,g:"if(e(t[n],n,g)===false)return E"},M={a:"z,H,l",i:"var a=arguments,b=0,c=typeof l=='number'?2:a.length;while(++b<c){t=a[b];if(t&&B[typeof t]){",v:L,g:"if(typeof E[n]=='undefined')E[n]=t[n]",c:"}}"},C={i:"if(!B[typeof t])return E;"+t.i,b:!1},T=I(t),M=I(M,{i:M.i.replace(";",";if(c>3&&typeof a[c-2]=='function'){var e=d(a[--c-1],a[c--],2)}else if(c>2&&typeof a[c-1]=='function'){e=a[--c]}"),g:"E[n]=e?e(E[n],t[n]):t[n]"}),ca=I(t,C,{j:!1}),Ia=I(t,C);B(/x/)&&(B=function(a){return"function"==typeof a&&"[object Function]"==u.call(a)}),f.assign=M,f.bind=pa,f.createCallback=function(a,c,b){var d=typeof a;if(null==a||"function"==d)return na(a,c,b);if("object"!=d)return Ea(a);var e=L(a),f=e[0],g=a[f];return 1!=e.length||g!==g||z(g)?function(c){for(var b=e.length,d=!1;b--&&(d=E(c[e[b]],a[e[b]],null,!0)););return d}:function(a){return a=a[f],g===a&&(0!==g||1/g==1/a)}},f.filter=ya,f.flatten=function(a,c,b,d){return"boolean"!=typeof c&&null!=c&&(d=b,b="function"!=typeof c&&d&&d[c]===a?null:c,c=!1),null!=b&&(a=ha(a,b,d)),ra(a,c)},f.forEach=za,f.forIn=ca,f.forOwn=Ia,f.keys=L,f.map=ha,f.property=Ea,f.uniq=Ca,f.values=function(a){for(var c=-1,b=L(a),d=b.length,e=Array(d);++c<d;)e[c]=a[b[c]];return e},f.collect=ha,f.each=za,f.extend=M,f.select=ya,f.unique=Ca,f.find=ga,f.identity=ba,f.indexOf=Aa,f.isArguments=w,f.isArray=A,f.isEmpty=function(a){var c=!0;if(!a)return c;var b=u.call(a),d=a.length;return b==R||b==H||(g.argsClass?b==F:w(a))||b==G&&"number"==typeof d&&B(a.splice)?!d:(Ia(a,function(){return c=!1}),c)},f.isFunction=B,f.isObject=z,f.isString=xa,f.noop=Da,f.sortedIndex=Ba,f.detect=ga,f.findWhere=ga,f.VERSION="2.4.1","function"==typeof define&&"object"==typeof define.amd&&define.amd?(K._=f,define(function(){return f})):U&&V?Ua?(V.exports=f)._=f:U._=f:K._=f}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],30:[function(require,module){(function(){var lo,flatten,normalize,toString$={}.toString;lo=require("./lodash_lite"),flatten=function(items,res){var i$,len$,item;if(res||(res=[]),"String"===toString$.call(items).slice(8,-1))return items;for(i$=0,len$=items.length;len$>i$;++i$)item=items[i$],"Array"===toString$.call(item).slice(8,-1)?flatten(item,res):res.push(item);return res},normalize=function(items,recursed){var normalized;return normalized=function(){switch(toString$.call(items).slice(8,-1)){case"Function":return normalize(items(),!0);case"String":return recursed?items:[items];case"Array":return lo.map(items,function(item){return normalize(item,!0)});default:throw Error(items+" "+toString$.call(items).slice(8,-1)+" can't be normalized, must be a Function, String or Array")}}(),flatten(normalized)},module.exports=normalize}).call(this)},{"./lodash_lite":29}],31:[function(require,module){(function(){module.exports={camelCase:function(s){return(s||"").toLowerCase().replace(/(\b|-)\w/g,function(m){return m.toUpperCase().replace(/-/,"")})}}}).call(this)},{}]},{},[2]);