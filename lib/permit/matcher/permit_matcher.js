// Generated by LiveScript 1.2.0
(function(){
  var Intersect, AccessMatcher, Debugger, PermitMatcher;
  Intersect = require('../../util').Intersect;
  AccessMatcher = require('../../access_request').matcher.AccessMatcher;
  Debugger = require('../../util').Debugger;
  module.exports = PermitMatcher = (function(){
    PermitMatcher.displayName = 'PermitMatcher';
    var prototype = PermitMatcher.prototype, constructor = PermitMatcher;
    importAll$(prototype, arguments[0]);
    function PermitMatcher(context, accessRequest, debugging){
      this.context = context;
      this.accessRequest = accessRequest;
      this.debugging = debugging;
      this.validate();
      this;
    }
    prototype.matchers = {};
    prototype.match = function(options){
      options == null && (options = {});
      this.debug('match', options);
      return this.include() || this.matchCompiled() && !this.exclude();
    };
    prototype.matchCompiled = function(){
      return this._mc || (this._mc = new CompiledMatcher(this.context, this.accessRequest, this.debugging).match());
    };
    prototype.include = function(){
      return this._include || (this._include = this.matcher('include').match());
    };
    prototype.exclude = function(){
      return this._exclude || (this._exclude = this.matcher('exclude').match());
    };
    prototype.matcher = function(key){
      var ref$;
      return (ref$ = this.matchers)[key] || (ref$[key] = new ContextMatcher(this.context, key, this.accessRequest, this.debugging));
    };
    prototype.validate = function(){
      if (!this.context) {
        throw Error("PermitMatcher missing permit");
      }
      if (this.accessRequest != null && this.accessRequest === undefined) {
        throw Error("access-request is undefined");
      }
    };
    return PermitMatcher;
  }(Debugger));
  import$(PermitMatcher, Debugger);
  function importAll$(obj, src){
    for (var key in src) obj[key] = src[key];
    return obj;
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);
