// Generated by LiveScript 1.2.0
(function(){
  var obj, values, Debugger, extractName, calcName, Observable, PermitRegistry, toString$ = {}.toString;
  obj = require('../../util').object;
  values = obj.values;
  Debugger = require('../../util').Debugger;
  extractName = function(thing){
    switch (toString$.call(thing).slice(8, -1)) {
    case 'Object':
      return thing.name;
    case 'String':
      return thing;
    default:
      throw new Error("Can't find the name of " + thing);
    }
  };
  calcName = function(ctx, name){
    if (name === undefined) {
      name = "Permit-" + ctx.permitCount();
    }
    if (toString$.call(name).slice(8, -1) !== 'String') {
      throw Error("Name of permit must be a String, was: " + name);
    }
    return name;
  };
  Observable = require('../../mixin').Observable;
  module.exports = PermitRegistry = (function(){
    PermitRegistry.displayName = 'PermitRegistry';
    var prototype = PermitRegistry.prototype, constructor = PermitRegistry;
    importAll$(prototype, arguments[0]);
    importAll$(prototype, arguments[1]);
    function PermitRegistry(debugging){
      this.debugging = debugging;
    }
    prototype.permits = {};
    prototype.get = function(name){
      return this.permits[name] || (function(){
        throw Error("No permit '" + name + "' is registered");
      }());
    };
    prototype.unregister = function(permit){
      var name;
      name = extractName(permit);
      delete this.permits[name];
      this.unregistered();
      return this;
    };
    prototype.register = function(permit){
      var name;
      this.debug('register', this.permits, permit);
      name = calcName(this, permit.name);
      this.debug('permit name', name);
      if (this._mayRegister(name)) {
        this.permits[name] = permit;
        this.registered(permit);
      } else {
        this.debug('may not register permit:', name);
      }
      permit.name = name;
      this.debug('registered', this.permits, name);
      return this;
    };
    prototype.registered = function(permit){
      return this.notify(this, {
        'registered': permit
      });
    };
    prototype.unregistered = function(permit){
      return this.notify(this, {
        'registered': permit
      });
    };
    prototype.permitCount = function(){
      return Object.keys(this.permits).length;
    };
    prototype.permitList = function(){
      return values(this.permits);
    };
    prototype.cleanPermits = function(){
      var i$, ref$, len$, permit;
      for (i$ = 0, len$ = (ref$ = this.permitList()).length; i$ < len$; ++i$) {
        permit = ref$[i$];
        permit.clean();
      }
      return this;
    };
    prototype.clean = function(){
      this.permits = {};
      return this;
    };
    prototype._mayRegister = function(name){
      return !this.permits[name];
    };
    return PermitRegistry;
  }(Observable, Debugger));
  function importAll$(obj, src){
    for (var key in src) obj[key] = src[key];
    return obj;
  }
}).call(this);
