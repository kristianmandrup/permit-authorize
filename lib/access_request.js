// Generated by LiveScript 1.2.0
(function(){
  var normalize, Debugger, Fingerprints, AccessRequest, toString$ = {}.toString;
  normalize = require('./util/normalize');
  Debugger = require('./debugger');
  Fingerprints = require('./access_request/fingerprints');
  module.exports = AccessRequest = (function(){
    AccessRequest.displayName = 'AccessRequest';
    var prototype = AccessRequest.prototype, constructor = AccessRequest;
    importAll$(prototype, arguments[0]);
    importAll$(prototype, arguments[1]);
    AccessRequest.from = function(obj, debugging){
      if (toString$.call(obj).slice(8, -1) !== 'Object') {
        throw new Error("Must be an Object, was: " + obj);
      }
      return new AccessRequest(obj.user, obj.action, obj.subject, obj.ctx, debugging);
    };
    function AccessRequest(user, action, subject, ctx, debugging){
      this.user = user;
      this.action = action;
      this.subject = subject;
      this.ctx = ctx;
      this.debugging = debugging;
      this.debug('create AccessRequest user:', this.user, 'action:', this.action, 'subject:', this.subject, 'ctx:', this.ctx);
      this.validate();
      this.normalize();
      this;
    }
    prototype.normalize = function(){
      this.debug('normalize action', this.action);
      this.action = normalize(this.action);
      if (toString$.call(this.subject).slice(8, -1) !== 'Object') {
        this.debug('normalize subject', this.subject);
        this.subject = normalize(this.subject);
      }
      return this;
    };
    prototype.validate = function(){
      if (!this.validAction()) {
        throw new Error("Missing action name. Must authorize an action to be performed on a subject, was: " + this.action + ", " + toString$.call(this.action).slice(8, -1));
      }
      if (!this.validSubject()) {
        throw new Error("Missing subject. Must authorize a subject to perform an action: " + this.action);
      }
      if (!this.validUser()) {
        throw new Error("Missing or invalid user. Must authorize a user to perform an action: " + this.action + " on the subject, was: " + this.user + " of type: " + toString$.call(this.user).slice(8, -1));
      }
    };
    prototype.validSubject = function(){
      return this.subject != null;
    };
    prototype.validUser = function(){
      return toString$.call(this.user).slice(8, -1) === 'Object';
    };
    prototype.validAction = function(){
      return toString$.call(this.action).slice(8, -1) === 'String' || toString$.call(this.action).slice(8, -1) === 'Array';
    };
    return AccessRequest;
  }(Debugger, Fingerprints));
  function importAll$(obj, src){
    for (var key in src) obj[key] = src[key];
    return obj;
  }
}).call(this);
