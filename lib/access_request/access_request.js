// Generated by LiveScript 1.2.0
(function(){
  var normalize, Debugger, FingerPrinter, AccessRequest, toString$ = {}.toString;
  normalize = require('../util').normalize;
  Debugger = require('../util').Debugger;
  FingerPrinter = require('./fingerprint').FingerPrinter;
  module.exports = AccessRequest = (function(){
    AccessRequest.displayName = 'AccessRequest';
    var prototype = AccessRequest.prototype, constructor = AccessRequest;
    importAll$(prototype, arguments[0]);
    AccessRequest.from = function(obj, debugging){
      if (toString$.call(obj).slice(8, -1) !== 'Object') {
        throw new Error("Must be an Object, was: " + obj);
      }
      return new AccessRequest(obj.user, obj.action, obj.subject, obj.ctx, debugging);
    };
    function AccessRequest(user, action, subject, ctx, debugging){
      this.user = user;
      this.action = action;
      this.subject = subject;
      this.ctx = ctx;
      this.debugging = debugging;
      this.arObj = {
        user: this.user,
        action: this.action,
        subject: this.subject,
        ctx: this.ctx
      };
      this.debug('create AccessRequest user:', this.user, 'action:', this.action, 'subject:', this.subject, 'ctx:', this.ctx);
      this.validate();
      this.normalize();
      this;
    }
    prototype.fingerprint = function(){
      var _fingerprinter;
      _fingerprinter || (_fingerprinter = new FingerPrinter(this.arObj));
      return _fingerprinter.fingerprint();
    };
    prototype.normalize = function(){
      this.debug('normalize action', this.action);
      this.action = normalize(this.action);
      if (toString$.call(this.subject).slice(8, -1) !== 'Object') {
        this.debug('normalize subject', this.subject);
        this.subject = normalize(this.subject);
      }
      return this;
    };
    prototype.validate = function(){
      if (!this.validAction()) {
        console.log("ar", this.arObj);
        throw new Error("Missing action name. Must authorize an action to be performed on a subject, was: " + this.action + ", " + toString$.call(this.action).slice(8, -1));
      }
      if (!this.validSubject()) {
        console.log("ar", this.arObj);
        throw new Error("Missing subject. Must authorize a subject: " + this.subject + " to perform an action: " + this.action);
      }
      if (!this.validUser()) {
        console.log("ar", this.arObj);
        throw new Error("Missing or invalid user. Must authorize a user: " + this.user + " to perform an action: " + this.action);
      }
    };
    prototype.validSubject = function(){
      return this.subject != null;
    };
    prototype.validUser = function(){
      return toString$.call(this.user).slice(8, -1) === 'Object';
    };
    prototype.validAction = function(){
      return toString$.call(this.action).slice(8, -1) === 'String' || toString$.call(this.action).slice(8, -1) === 'Array';
    };
    return AccessRequest;
  }(Debugger));
  import$(AccessRequest, Debugger);
  function importAll$(obj, src){
    for (var key in src) obj[key] = src[key];
    return obj;
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);
