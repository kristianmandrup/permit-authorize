// Generated by LiveScript 1.2.0
(function(){
  var requires, PermitRegistry, RuleRepo, createPermit;
  requires = require('../../../requires');
  requires.test('test_setup');
  PermitRegistry = requires.permit('permit_registry');
  RuleRepo = requires.rule('rule_repo');
  createPermit = requires.fac('create-permit');
  describe('PermitRegistry', function(){
    var permits;
    permits = {};
    describe('create instance', function(){
      return specify('should throw error', function(){
        return function(){
          return new PermitRegistry;
        }.should['throw'];
      });
    });
    return context('singleton', function(){
      describe('initial state', function(){
        describe('permits', function(){
          return specify('should be empty', function(){
            return PermitRegistry.permits.should.eql({});
          });
        });
        describe('permit-counter', function(){
          return specify('should be 0', function(){
            return PermitRegistry.permitCounter.should.eql(0);
          });
        });
        return describe('calc-name', function(){
          return context('no argument', function(){
            return specify('should generate name Permit-0', function(){
              return PermitRegistry.calcName().should.eql('Permit-0');
            });
          });
        });
      });
      describe('register-permit', function(){
        return context('cleared permits', function(){
          before(function(){
            return PermitRegistry.clearAll();
          });
          return describe('permit-counter', function(){
            return specify('should reset to 0', function(){
              return PermitRegistry.calcName().should.eql('Permit-0');
            });
          });
        });
      });
      describe('create a permit', function(){
        before(function(){
          PermitRegistry.clearAll();
          return permits.guest = createPermit.guest();
        });
        describe('permits', function(){
          return specify('should have guest permit', function(){
            return PermitRegistry.permits['guest books'].should.eql(permits.guest);
          });
        });
        return describe('permit-counter', function(){
          return specify('should be 1', function(){
            return PermitRegistry.permitCounter.should.eql(1);
          });
        });
      });
      return context('guest permit', function(){
        before(function(){
          PermitRegistry.clearAll();
          return permits.guest = createPermit.guest();
        });
        describe('clear-all', function(){
          return context('cleared permits', function(){
            before(function(){
              return PermitRegistry.clearAll();
            });
            describe('permit-counter', function(){
              return specify('should reset to 0', function(){
                return PermitRegistry.calcName().should.eql('Permit-0');
              });
            });
            return describe('permits', function(){
              return specify('should be empty', function(){
                return PermitRegistry.permits.should.eql({});
              });
            });
          });
        });
        return describe('clean-all', function(){
          return context('cleaned permits', function(){
            var counters, repos;
            counters = {};
            repos = {};
            before(function(){
              PermitRegistry.clearAll();
              permits.guest = createPermit.guest();
              counters.old = PermitRegistry.permitCounter;
              permits.old = PermitRegistry.permits;
              repos.old = permits.guest.ruleRepo;
              permits.guest.debugOn();
              return PermitRegistry.cleanAll();
            });
            specify('old repo is a RuleRepo', function(){
              return repos.old.constructor.should.eql(RuleRepo);
            });
            describe('permit-counter', function(){
              return specify('should not change', function(){
                return PermitRegistry.permitCounter.should.eql(counters.old);
              });
            });
            describe('permits', function(){
              return specify('should not change', function(){
                return PermitRegistry.permits.should.eql(permits.old);
              });
            });
            return describe('repo', function(){
              return describe('should be cleaned', function(){
                var cleanedPermit;
                before(function(){
                  return cleanedPermit = PermitRegistry.permits['guest books'];
                });
                specify('repo is same instance', function(){
                  return cleanedPermit.ruleRepo.should.eql(repos.old);
                });
                specify('repo can-rules are empty', function(){
                  return cleanedPermit.ruleRepo.canRules.should.eql({});
                });
                specify('repo cannot-rules are empty', function(){
                  return cleanedPermit.ruleRepo.cannotRules.should.eql({});
                });
                specify('can-rules are empty', function(){
                  return cleanedPermit.canRules().should.eql({});
                });
                return specify('cannot-rules are empty', function(){
                  return cleanedPermit.cannotRules().should.eql({});
                });
              });
            });
          });
        });
      });
    });
  });
}).call(this);
