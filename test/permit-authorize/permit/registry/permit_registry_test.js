// Generated by LiveScript 1.2.0
(function(){
  var requires, RuleRepo, PermitRegistry, Permit, createPermit;
  requires = require('../../../../requires');
  requires.test('test_setup');
  RuleRepo = requires.rule('repo').RuleRepo;
  PermitRegistry = requires.permit('registry').PermitRegistry;
  Permit = requires.permit('permit');
  createPermit = requires.fac('create-permit');
  describe('PermitRegistry', function(){
    var permits, registry;
    permits = {};
    describe('create instance', function(){
      return specify('should not throw error', function(){
        return function(){
          return new PermitRegistry;
        }.should.not['throw'];
      });
    });
    registry = function(){
      return new PermitRegistry;
    };
    return context('singleton', function(){
      var reg;
      before(function(){
        return reg = registry();
      });
      describe('initial state', function(){
        describe('permits', function(){
          return specify('should be empty', function(){
            return reg.permits.should.eql({});
          });
        });
        describe('permit-counter', function(){
          return specify('should be 0', function(){
            return reg.permitCounter.should.eql(0);
          });
        });
        return describe('calc-name', function(){
          return context('no argument', function(){
            return specify('should generate name Permit-0', function(){
              return reg.calcName().should.eql('Permit-0');
            });
          });
        });
      });
      describe('create a permit', function(){
        before(function(){
          permits.guest = createPermit.guest();
          return reg = Permit.registry;
        });
        describe('permits', function(){
          return specify('should have guest permit', function(){
            return reg.permits['guest books'].should.eql(permits.guest);
          });
        });
        return describe('permit-counter', function(){
          return specify('should be 1', function(){
            return reg.permitCounter.should.eql(1);
          });
        });
      });
      return context('guest permit', function(){
        before(function(){
          reg = Permit.registry;
          reg.clearAll();
          return permits.guest = createPermit.guest();
        });
        describe('clear-all', function(){
          return context('cleared permits', function(){
            before(function(){
              return reg.clearAll();
            });
            describe('permit-counter', function(){
              return specify('should reset to 0', function(){
                return reg.calcName().should.eql('Permit-0');
              });
            });
            return describe('permits', function(){
              return specify('should be empty', function(){
                return reg.permits.should.eql({});
              });
            });
          });
        });
        return describe('clean-all', function(){
          return context('cleaned permits', function(){
            var counters, repos;
            counters = {};
            repos = {};
            before(function(){
              reg.clearAll();
              permits.guest = createPermit.guest();
              counters.old = reg.permitCounter;
              permits.old = reg.permits;
              repos.old = permits.guest.ruleRepo;
              permits.guest.debugOn();
              return reg.cleanAll();
            });
            specify('old repo is a RuleRepo', function(){
              return repos.old.constructor.should.eql(RuleRepo);
            });
            describe('permit-counter', function(){
              return specify('should not change', function(){
                return reg.permitCounter.should.eql(counters.old);
              });
            });
            describe('permits', function(){
              return specify('should not change', function(){
                return reg.permits.should.eql(permits.old);
              });
            });
            return describe('repo', function(){
              return describe('should be cleaned', function(){
                var cleanedPermit;
                before(function(){
                  return cleanedPermit = reg.permits['guest books'];
                });
                specify('repo is same instance', function(){
                  return cleanedPermit.ruleRepo.should.eql(repos.old);
                });
                specify('repo can-rules are empty', function(){
                  return cleanedPermit.ruleRepo.canRules.should.eql({});
                });
                specify('repo cannot-rules are empty', function(){
                  return cleanedPermit.ruleRepo.cannotRules.should.eql({});
                });
                specify('can-rules are empty', function(){
                  return cleanedPermit.canRules().should.eql({});
                });
                return specify('cannot-rules are empty', function(){
                  return cleanedPermit.cannotRules().should.eql({});
                });
              });
            });
          });
        });
      });
    });
  });
}).call(this);
